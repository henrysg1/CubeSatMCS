"use strict";(self.webpackChunkwebapp=self.webpackChunkwebapp||[]).push([[172],{3172:(pt,w,l)=>{l.r(w),l.d(w,{StorageModule:()=>gt});var Q=l(7216),p=l(1896),O=l(7914),M=l(9183),e=l(5879),u=l(6516),h=l(6814);let $=(()=>{class a{static#e=this.\u0275fac=function(n){return new(n||a)};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["ng-component"]],decls:5,vars:4,consts:[["messageBar",""],[1,"mat-typography","storage-page-content"]],template:function(n,o){if(1&n&&(e._UZ(0,"ya-message-bar",null,0),e.TgZ(2,"div",1),e.ALo(3,"async"),e._UZ(4,"router-outlet"),e.qZA()),2&n){const c=e.MAs(1);e.xp6(2),e.ekj("message-bar-visible",e.lcZ(3,2,c.show$))}},dependencies:[p.lC,u.pc,h.Ov],styles:[".storage-page-content[_ngcontent-%COMP%]{position:absolute;inset:48px 0 0;background-color:#f7f7f7}.storage-page-content.message-bar-visible[_ngcontent-%COMP%]{top:112px}mat-toolbar[_ngcontent-%COMP%]{background-color:#fcfcfc;border-bottom:1px solid #d3d3d3;box-sizing:content-box;color:#000000a7}"],changeDetection:0})}return a})();var B=l(5861),U=l(8337),g=l(9538),b=l(5619),L=l(2181),F=l(1087),d=l(6223),m=l(7700);let z=(()=>{class a{constructor(t,n,o,c){this.dialogRef=t,this.data=c,this.storageClient=o.createStorageClient(),this.form=n.group({name:["",d.kI.required]})}save(){let{path:t,bucket:n}=this.data;t.startsWith("/")&&(t=t.substring(1));const o=this.form.value.name;this.storageClient.uploadObject(n,t?`${t}/${o}/`:`${o}/`,new Blob).then(()=>this.dialogRef.close(!0))}static#e=this.\u0275fac=function(n){return new(n||a)(e.Y36(m.so),e.Y36(d.QS),e.Y36(u.C8),e.Y36(m.WI))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["ng-component"]],decls:12,vars:2,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"ya-form",3,"formGroup"],["type","text","formControlName","name","pattern","\\w[\\w\\s\\.\\-\\(\\)\\[\\]]*"],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"disabled","click"]],template:function(n,o){1&n&&(e.TgZ(0,"h2",0),e._uU(1,"Create folder"),e.qZA(),e.TgZ(2,"mat-dialog-content",1)(3,"form",2)(4,"label"),e._uU(5," Folder name "),e._UZ(6,"input",3),e.qZA()()(),e.TgZ(7,"mat-dialog-actions",4)(8,"button",5),e._uU(9,"CANCEL"),e.qZA(),e.TgZ(10,"button",6),e.NdJ("click",function(){return o.save()}),e._uU(11,"CREATE"),e.qZA()()),2&n&&(e.xp6(3),e.Q6J("formGroup",o.form),e.xp6(7),e.Q6J("disabled",!o.form.valid))},dependencies:[d._Y,d.Fj,d.JJ,d.JL,d.c5,d.sg,d.u,m.ZT,m.uh,m.xY,m.H8],encapsulation:2,changeDetection:0})}return a})(),I=(()=>{class a{constructor(t,n,o,c,s){this.dialogRef=t,this.data=s,this.storageClient=o.createStorageClient();const r=c.transform(this.data.name);this.filenameForm=n.group({name:[r,[d.kI.required]]})}rename(){var t=this;return(0,B.Z)(function*(){let n;const o=t.data.name.lastIndexOf("/");-1!==o&&(n=t.data.name.substring(0,o+1));const s=yield(yield t.storageClient.getObject(t.data.bucket,t.data.name)).blob(),r=(n||"")+t.filenameForm.get("name").value;yield t.storageClient.uploadObject(t.data.bucket,r,s),yield t.storageClient.deleteObject(t.data.bucket,t.data.name),t.dialogRef.close(r)})()}static#e=this.\u0275fac=function(n){return new(n||a)(e.Y36(m.so),e.Y36(d.QS),e.Y36(u.C8),e.Y36(u.XB),e.Y36(m.WI))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["app-rename-object-dialog"]],decls:13,vars:4,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"ya-form",3,"formGroup"],["type","text","formControlName","name"],["filename",""],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"disabled","click"]],template:function(n,o){if(1&n&&(e.TgZ(0,"h2",0),e._uU(1,"Rename file"),e.qZA(),e.TgZ(2,"mat-dialog-content",1)(3,"form",2)(4,"label"),e._uU(5," Name "),e._UZ(6,"input",3,4),e.qZA()()(),e.TgZ(8,"mat-dialog-actions",5)(9,"button",6),e._uU(10,"CANCEL"),e.qZA(),e.TgZ(11,"button",7),e.NdJ("click",function(){return o.rename()}),e._uU(12,"RENAME"),e.qZA()()),2&n){let c;e.xp6(3),e.Q6J("formGroup",o.filenameForm),e.xp6(1),e.ekj("invalid",null==(c=o.filenameForm.get("name"))?null:c.invalid),e.xp6(7),e.Q6J("disabled",!o.filenameForm.valid)}},dependencies:[d._Y,d.Fj,d.JJ,d.JL,d.sg,d.u,m.ZT,m.uh,m.xY,m.H8],encapsulation:2})}return a})();var R=l(3620),k=l(2296),x=l(617),H=l(2596);const E=["tableWrapper"];function G(a,i){1&a&&(e.ynx(0),e._uU(1," Finished "),e.BQk())}function W(a,i){if(1&a&&(e.ynx(0),e.TgZ(1,"mat-icon",10),e._uU(2,"error"),e.qZA(),e._uU(3," Failed "),e.BQk()),2&a){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("matTooltip",t.err)}}function X(a,i){1&a&&e._UZ(0,"ya-dots")}function V(a,i){if(1&a&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td",8),e.YNc(4,G,2,0,"ng-container",9),e.YNc(5,W,4,1,"ng-container",9),e.YNc(6,X,1,0,"ya-dots",9),e.qZA()()),2&a){const t=i.$implicit;e.ekj("failed",t.err),e.xp6(2),e.Oqu(t.filename),e.xp6(2),e.Q6J("ngIf",t.complete&&!t.err),e.xp6(1),e.Q6J("ngIf",t.complete&&t.err),e.xp6(1),e.Q6J("ngIf",!t.complete)}}let K=(()=>{class a{constructor(t,n){this.data=n,this.uploads$=n.uploads$.pipe((0,R.b)(500))}static#e=this.\u0275fac=function(n){return new(n||a)(e.Y36(m.so),e.Y36(m.WI))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["app-upload-progress-dialog"]],viewQuery:function(n,o){if(1&n&&e.Gf(E,7),2&n){let c;e.iGM(c=e.CRH())&&(o.tableWrapper=c.first)}},decls:12,vars:3,consts:[["mat-dialog-title",""],[2,"float","right"],["mat-icon-button","","mat-dialog-close",""],[1,"mat-typography"],[1,"table-wrapper"],["tableWrapper",""],[2,"font-size","small","width","100%"],[3,"failed",4,"ngFor","ngForOf"],[2,"width","100px","text-align","center"],[4,"ngIf"],[1,"icon14",2,"vertical-align","middle",3,"matTooltip"]],template:function(n,o){1&n&&(e.TgZ(0,"h3",0)(1,"div",1)(2,"button",2)(3,"mat-icon"),e._uU(4,"close"),e.qZA()()(),e._uU(5," Uploads\n"),e.qZA(),e.TgZ(6,"mat-dialog-content",3)(7,"div",4,5)(9,"table",6),e.YNc(10,V,7,6,"tr",7),e.ALo(11,"async"),e.qZA()()()),2&n&&(e.xp6(10),e.Q6J("ngForOf",e.lcZ(11,1,o.uploads$)))},dependencies:[h.sg,h.O5,k.RK,m.ZT,m.uh,m.xY,x.Hw,H.gM,u.Zy,h.Ov],styles:["tr.failed[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{color:red}h3.mat-mdc-dialog-title[_ngcontent-%COMP%]{background-color:#24292e;color:#fff;margin:0;padding-left:5px;font-size:16px;line-height:40px}table[_ngcontent-%COMP%]{border-collapse:collapse}.table-wrapper[_ngcontent-%COMP%]{height:150px;overflow-y:scroll;overflow-x:hidden;padding:5px}"],changeDetection:0})}return a})();var T=l(6593),_=l(4643),ee=l(6385),j=l(7988),v=l(2651),y=l(4104);const te=function(a){return["/storage/buckets",a,"objects"]},ae=function(a){return["/storage/buckets",a,"properties"]};let q=(()=>{class a{constructor(t){this.yamcs=t}static#e=this.\u0275fac=function(n){return new(n||a)(e.Y36(u.C8))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["app-bucket-page-tabs"]],inputs:{bucket:"bucket"},decls:10,vars:10,consts:[["mat-tab-nav-bar","",1,"secondary",3,"mat-stretch-tabs","tabPanel"],["mat-tab-link","","routerLinkActive","",3,"routerLink","active"],["rla","routerLinkActive"],["rlb","routerLinkActive"],["tabPanel",""]],template:function(n,o){if(1&n&&(e.TgZ(0,"nav",0)(1,"a",1,2),e._uU(3," Objects "),e.qZA(),e.TgZ(4,"a",1,3),e._uU(6," Properties "),e.qZA()(),e.TgZ(7,"mat-tab-nav-panel",null,4),e._UZ(9,"router-outlet"),e.qZA()),2&n){const c=e.MAs(2),s=e.MAs(5),r=e.MAs(8);e.Q6J("mat-stretch-tabs",!1)("tabPanel",r),e.xp6(1),e.Q6J("routerLink",e.VKq(6,te,o.bucket))("active",c.isActive),e.xp6(3),e.Q6J("routerLink",e.VKq(8,ae,o.bucket))("active",s.isActive)}},dependencies:[p.lC,p.rH,p.Od,y.BU,y.sW,y.Nj],styles:[".mat-mdc-tab-link[_ngcontent-%COMP%]{height:36px;min-width:0;font-size:13px}"],changeDetection:0})}return a})();const ne=[[["app-storage-toolbar"]],[["ya-detail-pane"]],"*"],oe=["app-storage-toolbar","ya-detail-pane","*"];let A=(()=>{class a{constructor(){this.noscroll=!1}static#e=this.\u0275fac=function(n){return new(n||a)};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["app-storage-page"]],inputs:{noscroll:"noscroll"},ngContentSelectors:oe,decls:4,vars:2,consts:[[1,"page-content"]],template:function(n,o){1&n&&(e.F$t(ne),e.Hsn(0),e.TgZ(1,"div",0),e.Hsn(2,1),e.Hsn(3,2),e.qZA()),2&n&&(e.xp6(1),e.Udp("overflow",o.noscroll?"hidden":"auto"))},styles:[".page-content[_ngcontent-%COMP%]{position:absolute;inset:49px 0 0;overflow:auto}"],changeDetection:0})}return a})();var S=l(1274);const ce=["*"];let P=(()=>{class a{static#e=this.\u0275fac=function(n){return new(n||a)};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["app-storage-toolbar"]],ngContentSelectors:ce,decls:4,vars:0,consts:[[1,"top"],[2,"flex","1 1 auto"]],template:function(n,o){1&n&&(e.F$t(),e.TgZ(0,"mat-toolbar",0)(1,"mat-toolbar-row"),e.Hsn(2),e._UZ(3,"span",1),e.qZA()())},dependencies:[S.Ye,S.rD],styles:["mat-toolbar[_ngcontent-%COMP%]{border-bottom:1px solid rgba(0,0,0,.1);background-color:#f7f7f7;box-sizing:content-box}mat-toolbar-row[_ngcontent-%COMP%]{padding-left:24px}.hide[_ngcontent-%COMP%]{visibility:hidden}.toolbar-text[_ngcontent-%COMP%]{font-size:12px}"],changeDetection:0})}return a})();const ie=["droparea"],se=["uploader"];function re(a,i){1&a&&(e.TgZ(0,"mat-icon"),e._uU(1,"image_not_supported"),e.qZA())}function le(a,i){1&a&&(e.TgZ(0,"mat-icon"),e._uU(1,"image"),e.qZA())}function ue(a,i){if(1&a&&(e.ynx(0),e._UZ(1,"img",19),e.BQk()),2&a){const t=e.oxw();e.xp6(1),e.Q6J("src",t.selection.selected[0].objectUrl,e.LSH)}}function de(a,i){1&a&&(e.TgZ(0,"div",20)(1,"mat-icon"),e._uU(2,"arrow_back"),e.qZA(),e.TgZ(3,"p"),e._uU(4," Select an image to make it appear here "),e.qZA()())}function me(a,i){if(1&a&&e._UZ(0,"ya-breadcrumb",23),2&a){const t=i.$implicit;e.Q6J("link",t.route)("label",t.name)}}const ge=function(){return["/storage/buckets"]},pe=function(a){return["/storage/buckets",a,"objects"]};function he(a,i){if(1&a&&(e.TgZ(0,"div",21)(1,"ya-breadcrumb-trail"),e._UZ(2,"ya-breadcrumb",22)(3,"ya-breadcrumb",23),e.YNc(4,me,1,2,"ya-breadcrumb",24),e.qZA()()),2&a){const t=i.ngIf,n=e.oxw();e.xp6(2),e.Q6J("link",e.DdM(4,ge)),e.xp6(1),e.Q6J("link",e.VKq(5,pe,n.name))("label",n.name),e.xp6(1),e.Q6J("ngForOf",t)}}function _e(a,i){if(1&a){const t=e.EpF();e.TgZ(0,"th",39)(1,"input",40),e.NdJ("change",function(o){e.CHM(t);const c=e.oxw(2);return e.KtG(o?c.masterToggle():null)}),e.qZA()()}if(2&a){const t=e.oxw(2);e.xp6(1),e.Q6J("checked",t.selection.hasValue()&&t.isAllSelected())}}function fe(a,i){if(1&a){const t=e.EpF();e.TgZ(0,"td",41)(1,"input",42),e.NdJ("click",function(o){return o.stopPropagation()})("change",function(o){const s=e.CHM(t).$implicit,r=e.oxw(2);return e.KtG(o?r.selection.toggle(s):null)}),e.qZA()()}if(2&a){const t=i.$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("checked",n.selection.isSelected(t))}}function be(a,i){1&a&&(e.TgZ(0,"th",43),e._uU(1,"Name"),e.qZA())}function ke(a,i){if(1&a&&(e.ynx(0),e.TgZ(1,"mat-icon",45),e._uU(2,"folder"),e.qZA(),e.TgZ(3,"a",46),e.NdJ("click",function(n){return n.stopPropagation()}),e._uU(4),e.ALo(5,"filename"),e.qZA(),e.BQk()),2&a){const t=e.oxw().$implicit,n=e.oxw(2);e.xp6(3),e.Q6J("routerLink","/storage/buckets/"+n.name+"/objects/"+t.name),e.xp6(1),e.hij("",e.lcZ(5,2,t.name)," ")}}function xe(a,i){if(1&a&&(e.ynx(0),e.TgZ(1,"mat-icon",45),e._uU(2,"description"),e.qZA(),e.TgZ(3,"a",47),e.NdJ("click",function(n){return n.stopPropagation()}),e._uU(4),e.ALo(5,"filename"),e.qZA(),e.BQk()),2&a){const t=e.oxw().$implicit;e.xp6(3),e.Q6J("href",t.objectUrl,e.LSH),e.xp6(1),e.hij("",e.lcZ(5,2,t.name)," ")}}function Ze(a,i){if(1&a&&(e.TgZ(0,"td",44),e.YNc(1,ke,6,4,"ng-container",5),e.YNc(2,xe,6,4,"ng-container",5),e.qZA()),2&a){const t=i.$implicit;e.xp6(1),e.Q6J("ngIf",t.folder),e.xp6(1),e.Q6J("ngIf",!t.folder)}}function Te(a,i){1&a&&(e.TgZ(0,"th",43),e._uU(1,"Date modified"),e.qZA())}function ve(a,i){if(1&a&&(e.TgZ(0,"td",44),e._uU(1),e.ALo(2,"datetime"),e.qZA()),2&a){const t=i.$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,1,t.modified)||"-"," ")}}function ye(a,i){1&a&&(e.TgZ(0,"th",43),e._uU(1,"Size"),e.qZA())}function Ae(a,i){if(1&a&&(e.TgZ(0,"td",44),e._uU(1),e.ALo(2,"formatBytes"),e.qZA()),2&a){const t=i.$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,1,t.size)||"-"," ")}}function Pe(a,i){1&a&&e._UZ(0,"th",48)}function Ce(a,i){if(1&a){const t=e.EpF();e.TgZ(0,"ya-more")(1,"button",49),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,c=e.oxw(2);return e.KtG(c.renameFile(o))}),e._uU(2," Rename "),e.qZA(),e.TgZ(3,"a",50),e._uU(4," Download "),e.qZA(),e._UZ(5,"mat-divider"),e.TgZ(6,"button",49),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,c=e.oxw(2);return e.KtG(c.deleteFile(o))}),e._uU(7," Delete "),e.qZA()()}if(2&a){const t=e.oxw().$implicit;e.xp6(3),e.Q6J("href",t.objectUrl,e.LSH)}}function we(a,i){if(1&a&&(e.TgZ(0,"td",44),e.YNc(1,Ce,8,1,"ya-more",5),e.qZA()),2&a){const t=i.$implicit;e.xp6(1),e.Q6J("ngIf",!t.folder)}}function Oe(a,i){1&a&&e._UZ(0,"tr",51)}function Be(a,i){if(1&a){const t=e.EpF();e.TgZ(0,"tr",52),e.NdJ("click",function(){const c=e.CHM(t).$implicit,s=e.oxw(2);return e.KtG(s.toggleOne(c))}),e.qZA()}if(2&a){const t=i.$implicit,n=e.oxw(2);e.ekj("selected",n.selection.isSelected(t))}}function Ue(a,i){if(1&a&&(e.TgZ(0,"table",25),e.ynx(1,26),e.YNc(2,_e,2,1,"th",27),e.YNc(3,fe,2,1,"td",28),e.BQk(),e.ynx(4,29),e.YNc(5,be,2,0,"th",30),e.YNc(6,Ze,3,2,"td",31),e.BQk(),e.ynx(7,32),e.YNc(8,Te,2,0,"th",30),e.YNc(9,ve,3,3,"td",31),e.BQk(),e.ynx(10,33),e.YNc(11,ye,2,0,"th",30),e.YNc(12,Ae,3,3,"td",31),e.BQk(),e.ynx(13,34),e.YNc(14,Pe,1,0,"th",35),e.YNc(15,we,2,1,"td",36),e.BQk(),e.YNc(16,Oe,1,0,"tr",37),e.YNc(17,Be,1,2,"tr",38),e.qZA()),2&a){const t=e.oxw();e.Q6J("dataSource",t.dataSource),e.xp6(16),e.Q6J("cdkHeaderRowDef",t.displayedColumns),e.xp6(1),e.Q6J("cdkRowDefColumns",t.displayedColumns)}}function je(a,i){1&a&&(e.TgZ(0,"ya-empty-message"),e._uU(1,"Empty directory."),e.qZA())}let D=(()=>{class a{constructor(t,n,o,c,s){this.dialog=t,this.route=o,this.breadcrumb$=new b.X([]),this.dragActive$=new b.X(!1),this.showPreview$=new b.X(!1),this.previewWidth$=new b.X(600),this.displayedColumns=["select","name","size","modified","actions"],this.dataSource=new g.by([]),this.selection=new U.Ov(!0,[]),this.uploads$=new b.X([]),this.progressDialogOpen=!1,this.name=o.snapshot.parent.parent.paramMap.get("name"),s.setTitle(this.name),this.storageClient=c.createStorageClient(),this.loadCurrentFolder(),this.routerSubscription=n.events.pipe((0,L.h)(r=>r instanceof p.m2)).subscribe(()=>{this.loadCurrentFolder()})}loadCurrentFolder(){const t={delimiter:"/"},n=this.route.snapshot.url;n.length&&(t.prefix=n.map(o=>o.path).join("/")+"/"),this.storageClient.listObjects(this.name,t).then(o=>{this.updateBrowsePath(),this.changedir(o)})}changedir(t){this.selection.clear();const n=[];for(const o of t.prefixes||[])n.push({folder:!0,name:o});for(const o of t.objects||[])o.name.endsWith("/")||n.push({folder:!1,name:o.name,modified:o.created,size:o.size,objectUrl:this.storageClient.getObjectURL(this.name,o.name)});this.dataSource.data=n}isAllSelected(){const n=this.dataSource.filteredData.length;return this.selection.selected.length===n&&n>0}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.filteredData.forEach(t=>this.selection.select(t))}toggleOne(t){(!this.selection.isSelected(t)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(t)}createFolder(){this.dialog.open(z,{width:"400px",data:{bucket:this.name,path:this.getCurrentPath()}}).afterClosed().subscribe({next:()=>this.loadCurrentFolder()})}uploadObjects(){let t=this.getCurrentPath();t.startsWith("/")&&(t=t.substring(1));const n=this.uploaderEl.nativeElement.files,o=[];for(const c in n)if(!isNaN(parseInt(c,10))){const s=n[c],Z=this.storageClient.uploadObject(this.name,t?t+"/"+s.name:s.name,s);o.push({filename:s.name,promise:Z})}o.length&&this.showUploadProgress().then(()=>{for(const c of o)this.trackUpload(c);this.settlePromises(o.map(c=>c.promise)).then(()=>{this.loadCurrentFolder()})})}settlePromises(t){return Promise.all(t.map(n=>n.then(o=>({state:"fullfilled",value:o}),o=>({state:"rejected",value:o}))))}trackUpload(t){t.promise.then(()=>{t.complete=!0,this.uploads$.next([...this.uploads$.value])}).catch(n=>{n.response.json().then(o=>{t.complete=!0,t.err=o.msg,this.uploads$.next([...this.uploads$.value])}).catch(()=>{t.complete=!0,t.err=n.statusText,this.uploads$.next([...this.uploads$.value])})}),this.uploads$.next([...this.uploads$.value,t])}getCurrentPath(){let t="";for(const n of this.route.snapshot.url)t+="/"+n.path;return t||"/"}togglePreview(){this.showPreview$.next(!this.showPreview$.value)}deleteSelectedObjects(){const t=[],n=[];for(const o of this.selection.selected)o.folder?n.push(this.storageClient.listObjects(this.name,{prefix:o.name}).then(c=>{t.push(...(c.objects||[]).map(r=>r.name))})):t.push(o.name);Promise.all(n).then(()=>{if(confirm(`You are about to delete ${t.length} files. Are you sure you want to continue?`)){const o=[];for(const c of t)o.push(this.storageClient.deleteObject(this.name,c));Promise.all(o).then(()=>{this.loadCurrentFolder()})}})}renameFile(t){this.dialog.open(I,{data:{bucket:this.name,name:t.name},width:"400px"}).afterClosed().subscribe(o=>{o&&this.loadCurrentFolder()})}deleteFile(t){confirm(`Are you sure you want to delete ${t.name}?`)&&this.storageClient.deleteObject(this.name,t.name).then(()=>{this.loadCurrentFolder()})}dragEnter(t){return this.dragActive$.next(!0),t.preventDefault(),t.stopPropagation(),!1}dragOver(t){return t.preventDefault(),t.stopPropagation(),!1}dragLeave(t){return this.dragActive$.next(!1),t.preventDefault(),t.stopPropagation(),!1}drop(t){const n=t.dataTransfer||{};if(n){let o=this.getCurrentPath().substring(1);""!==o&&(o+="/"),F.v(n).then(c=>{if(c.length){const s=[];this.showUploadProgress().then(()=>{for(const r of c){const Z=this.storageClient.uploadObject(this.name,o+r._fullPath,r);this.trackUpload({filename:r._fullPath,promise:Z}),s.push(Z)}this.settlePromises(s).then(()=>{this.loadCurrentFolder()})})}})}return this.dragActive$.next(!1),t.preventDefault(),t.stopPropagation(),!1}updateBrowsePath(){const t=[];let n="";for(const o of this.route.snapshot.url)n+="/"+o.path,t.push({name:o.path,route:`/storage/buckets/${this.name}/objects`+n});return this.breadcrumb$.next(t),n||"/"}isImage(t){if(t.folder)return!1;const n=t.name.toLocaleLowerCase();return n.endsWith(".png")||n.endsWith(".gif")||n.endsWith(".jpg")||n.endsWith("jpeg")||n.endsWith("bmp")||n.endsWith("svg")||n.endsWith("ico")}showUploadProgress(){var t=this;return(0,B.Z)(function*(){if(!t.progressDialogOpen)return t.dialogRef=t.dialog.open(K,{position:{bottom:"10px",right:"10px"},width:"500px",data:{uploads$:t.uploads$},hasBackdrop:!1,autoFocus:!1,panelClass:["progress-dialog","mat-elevation-z2"]}),t.dialogRef.afterOpened().subscribe(()=>t.progressDialogOpen=!0),t.dialogRef.afterClosed().subscribe(()=>{t.uploads$.next([]),t.progressDialogOpen=!1}),new Promise((n,o)=>{t.dialogRef.afterOpened().subscribe(()=>{n(!0)},c=>{o(c)})})})()}resizeMouseDown(t){let n=t.clientX;const o=this.previewWidth$.value,c=r=>{null!==n&&this.previewWidth$.next(Math.max(400,o-(r.clientX-n)))},s=r=>{n=null,document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",s)};document.addEventListener("mousemove",c),document.addEventListener("mouseup",s)}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.dialogRef&&this.dialogRef.close()}static#e=this.\u0275fac=function(n){return new(n||a)(e.Y36(m.uw),e.Y36(p.F0),e.Y36(p.gz),e.Y36(u.C8),e.Y36(T.Dx))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["ng-component"]],viewQuery:function(n,o){if(1&n&&(e.Gf(ie,7),e.Gf(se,5)),2&n){let c;e.iGM(c=e.CRH())&&(o.dropArea=c.first),e.iGM(c=e.CRH())&&(o.uploaderEl=c.first)}},decls:47,vars:33,consts:[["mat-icon-button","","routerLink","/storage/buckets","color","primary"],["mat-button","","color","primary",3,"click"],["type","file","hidden","","multiple","",3,"change"],["uploader",""],["mat-button","","color","primary",3,"disabled","click"],[4,"ngIf"],[1,"droparea",3,"dragenter"],["droparea",""],[1,"droparea-overlay",3,"dragover","dragleave","drop"],[3,"autosize"],["mode","side","position","end",2,"text-align","center",3,"opened","disableClose"],[1,"resize-handle",3,"mousedown"],[4,"ngIf","ngIfElse"],["placeholder",""],[1,"panel-content"],[3,"bucket"],["style","margin-top: 16px",4,"ngIf"],["mat-table","","class","ya-data-table expand",3,"dataSource",4,"ngIf","ngIfElse"],["empty",""],[3,"src"],[2,"margin-top","4em","color","#fff"],[2,"margin-top","16px"],["label","Buckets",3,"link"],[3,"link","label"],[3,"link","label",4,"ngFor","ngForOf"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",4,"cdkCellDef"],["cdkColumnDef","name"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","modified"],["cdkColumnDef","size"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"cdkHeaderRowDef"],["mat-row","",3,"selected","click",4,"cdkRowDef","cdkRowDefColumns"],["mat-header-cell","",1,"checkbox"],["type","checkbox",3,"checked","change"],["mat-cell","",1,"checkbox"],["type","checkbox",3,"checked","click","change"],["mat-header-cell",""],["mat-cell",""],[1,"icon12",2,"vertical-align","middle","margin-right","7px"],[3,"routerLink","click"],["download","",3,"href","click"],["mat-header-cell","",1,"expand"],["mat-menu-item","",3,"click"],["mat-menu-item","","download","",3,"href"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(n,o){if(1&n){const c=e.EpF();e.TgZ(0,"app-storage-page")(1,"app-storage-toolbar")(2,"a",0)(3,"mat-icon"),e._uU(4,"arrow_back"),e.qZA()(),e._uU(5),e.TgZ(6,"button",1),e.NdJ("click",function(){e.CHM(c);const r=e.MAs(11);return e.KtG(r.click())}),e.TgZ(7,"mat-icon"),e._uU(8,"file_upload"),e.qZA(),e._uU(9," Upload files "),e.TgZ(10,"input",2,3),e.NdJ("change",function(){return o.uploadObjects()}),e.qZA()(),e.TgZ(12,"button",1),e.NdJ("click",function(){return o.createFolder()}),e.TgZ(13,"mat-icon"),e._uU(14,"create_new_folder"),e.qZA(),e._uU(15," Create folder "),e.qZA(),e.TgZ(16,"button",4),e.NdJ("click",function(){return o.deleteSelectedObjects()}),e.TgZ(17,"mat-icon"),e._uU(18,"delete"),e.qZA(),e._uU(19," Delete "),e.qZA(),e.TgZ(20,"button",1),e.NdJ("click",function(){return o.togglePreview()}),e.YNc(21,re,2,0,"mat-icon",5),e.ALo(22,"async"),e.YNc(23,le,2,0,"mat-icon",5),e.ALo(24,"async"),e._uU(25," Preview panel "),e.qZA()(),e.TgZ(26,"div",6,7),e.NdJ("dragenter",function(r){return o.dragEnter(r)}),e.ALo(28,"async"),e.TgZ(29,"div",8),e.NdJ("dragover",function(r){return o.dragOver(r)})("dragleave",function(r){return o.dragLeave(r)})("drop",function(r){return o.drop(r)}),e.ALo(30,"async"),e.qZA(),e.TgZ(31,"mat-sidenav-container",9)(32,"mat-sidenav",10),e.ALo(33,"async"),e.ALo(34,"async"),e.TgZ(35,"div",11),e.NdJ("mousedown",function(r){return o.resizeMouseDown(r)}),e.qZA(),e.YNc(36,ue,2,1,"ng-container",12),e.YNc(37,de,5,0,"ng-template",null,13,e.W1O),e.qZA(),e.TgZ(39,"mat-sidenav-content")(40,"div",14),e._UZ(41,"app-bucket-page-tabs",15),e.YNc(42,he,5,7,"div",16),e.ALo(43,"async"),e.YNc(44,Ue,18,3,"table",17),e.YNc(45,je,2,0,"ng-template",null,18,e.W1O),e.qZA()()()()()}if(2&n){const c=e.MAs(38),s=e.MAs(46);e.xp6(5),e.hij(" ",o.name," \xa0\xa0\xa0 "),e.xp6(11),e.Q6J("disabled",!o.selection.hasValue()),e.xp6(5),e.Q6J("ngIf",e.lcZ(22,19,o.showPreview$)),e.xp6(2),e.Q6J("ngIf",!e.lcZ(24,21,o.showPreview$)),e.xp6(3),e.ekj("active",e.lcZ(28,23,o.dragActive$)),e.xp6(3),e.ekj("hide",!e.lcZ(30,25,o.dragActive$)),e.xp6(2),e.Q6J("autosize",!0),e.xp6(1),e.Udp("width",e.lcZ(33,27,o.previewWidth$)+"px"),e.Q6J("opened",e.lcZ(34,29,o.showPreview$))("disableClose",!1),e.xp6(4),e.Q6J("ngIf",1===o.selection.selected.length&&o.isImage(o.selection.selected[0]))("ngIfElse",c),e.xp6(5),e.Q6J("bucket",o.name),e.xp6(1),e.Q6J("ngIf",e.lcZ(43,31,o.breadcrumb$)),e.xp6(2),e.Q6J("ngIf",o.dataSource&&o.dataSource.data.length)("ngIfElse",s)}},dependencies:[h.sg,h.O5,p.rH,_.Sq,_.O_,_.D5,_.fo,_.s$,k.lW,k.o6,x.Hw,ee.d,j.OP,v.JX,v.TM,v.Rh,g.BZ,g.fO,g.w1,g.Dz,g.ge,g.ev,g.XQ,g.Gk,u.LI,u.O_,u.RR,u.cQ,q,A,P,h.Ov,u.id,u.XB,u.bP],styles:["mat-toolbar[_ngcontent-%COMP%]{border-bottom:1px solid #d3d3d3;background-color:#fff;box-sizing:content-box;color:#000000a7}mat-toolbar-row[_ngcontent-%COMP%]{padding-left:24px}.droparea[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;overflow:auto;user-select:none;-webkit-user-select:none;-moz-user-select:none;-khtml-user-select:none}.droparea-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;box-sizing:border-box;background:rgba(27,97,185,.1);border:1px solid rgba(27,97,185,1);z-index:10;user-select:none;-webkit-user-select:none;-moz-user-select:none;-khtml-user-select:none}  .progress-dialog .mat-mdc-dialog-container{box-shadow:none;padding:0;overflow:hidden}  .progress-dialog .mat-mdc-dialog-content{overflow:hidden}.mat-sidenav-container[_ngcontent-%COMP%]{height:100%;width:100%;background-color:inherit}.mat-sidenav-container[_ngcontent-%COMP%]   .mat-sidenav[_ngcontent-%COMP%]{background-color:#000}.mat-sidenav[_ngcontent-%COMP%]   .mat-drawer-inner-container[_ngcontent-%COMP%]{overflow:hidden!important}.resize-handle[_ngcontent-%COMP%]{position:absolute;background-color:#000;top:0;left:0;width:20px;bottom:0;cursor:ew-resize;user-select:none;-webkit-user-select:none;-moz-user-select:none;-khtml-user-select:none}.mat-sidenav-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin:2em;max-width:calc(100% - 5em);max-height:calc(100% - 5em)}"],changeDetection:0})}return a})(),J=(()=>{class a{static#e=this.\u0275fac=function(n){return new(n||a)};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["ng-component"]],decls:1,vars:0,template:function(n,o){1&n&&e._UZ(0,"router-outlet")},dependencies:[p.lC],encapsulation:2,changeDetection:0})}return a})();function qe(a,i){if(1&a&&(e.ynx(0),e.TgZ(1,"dt"),e._uU(2,"Directory"),e.qZA(),e.TgZ(3,"dd"),e._uU(4),e.qZA(),e.BQk()),2&a){const t=e.oxw().ngIf;e.xp6(4),e.Oqu(t.directory)}}function Se(a,i){if(1&a&&(e.TgZ(0,"div",4)(1,"dl",5)(2,"dt"),e._uU(3,"Created"),e.qZA(),e.TgZ(4,"dd"),e._uU(5),e.ALo(6,"nvl"),e.ALo(7,"datetime"),e.qZA(),e.TgZ(8,"dt"),e._uU(9,"Storage engine"),e.qZA(),e.TgZ(10,"dd"),e._uU(11),e.qZA(),e.YNc(12,qe,5,1,"ng-container",6),e.qZA(),e.TgZ(13,"h3"),e._uU(14,"Bucket size"),e.qZA(),e.TgZ(15,"dl",5)(16,"dt"),e._uU(17,"Limit"),e.qZA(),e.TgZ(18,"dd"),e._uU(19),e.ALo(20,"nvl"),e.ALo(21,"formatBytes"),e.qZA(),e.TgZ(22,"dt"),e._uU(23,"Used"),e.qZA(),e.TgZ(24,"dd"),e._uU(25),e.ALo(26,"nvl"),e.ALo(27,"formatBytes"),e.qZA(),e.TgZ(28,"dt"),e._uU(29,"Available"),e.qZA(),e.TgZ(30,"dd"),e._uU(31),e.ALo(32,"formatBytes"),e.qZA()(),e.TgZ(33,"h3"),e._uU(34,"Object count"),e.qZA(),e.TgZ(35,"dl",5)(36,"dt"),e._uU(37,"Limit"),e.qZA(),e.TgZ(38,"dd"),e._uU(39),e.ALo(40,"nvl"),e.qZA(),e.TgZ(41,"dt"),e._uU(42,"Used"),e.qZA(),e.TgZ(43,"dd"),e._uU(44),e.ALo(45,"nvl"),e.qZA(),e.TgZ(46,"dt"),e._uU(47,"Available"),e.qZA(),e.TgZ(48,"dd"),e._uU(49),e.qZA()()()),2&a){const t=i.ngIf,n=e.oxw();e.xp6(5),e.Oqu(e.xi3(6,9,e.lcZ(7,12,t.created),"-")),e.xp6(6),e.Oqu(t.directory?"File System":"RocksDB"),e.xp6(1),e.Q6J("ngIf",t.directory),e.xp6(7),e.Oqu(e.xi3(20,14,e.lcZ(21,17,t.maxSize),"-")),e.xp6(6),e.Oqu(e.xi3(26,19,e.lcZ(27,22,t.size),"-")),e.xp6(6),e.Oqu(e.lcZ(32,24,n.zeroOrMore(t.maxSize-t.size))),e.xp6(8),e.Oqu(e.xi3(40,26,t.maxObjects,"-")),e.xp6(5),e.Oqu(e.xi3(45,29,t.numObjects,"-")),e.xp6(5),e.Oqu(n.zeroOrMore(t.maxObjects-t.numObjects))}}let N=(()=>{class a{constructor(t,n,o){this.bucket$=new b.X(null),this.name=t.snapshot.parent.paramMap.get("name"),o.setTitle(this.name+": Properties"),this.storageClient=n.createStorageClient(),this.storageClient.getBucket(this.name).then(c=>{this.bucket$.next(c)})}bucketSizePercentage(t,n=!1){var o=100*t.size/t.maxSize;return n?Math.min(100,o):o}objectCountPercentage(t,n=!1){var o=100*t.numObjects/t.maxObjects;return n?Math.min(100,o):o}zeroOrMore(t){return Math.max(0,t)}static#e=this.\u0275fac=function(n){return new(n||a)(e.Y36(p.gz),e.Y36(u.C8),e.Y36(T.Dx))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["ng-component"]],decls:10,vars:5,consts:[["mat-icon-button","","routerLink","/storage/buckets","color","primary"],[1,"panel-content"],[3,"bucket"],["class","small","style","margin-top: 16px",4,"ngIf"],[1,"small",2,"margin-top","16px"],[1,"dl-horizontal"],[4,"ngIf"]],template:function(n,o){1&n&&(e.TgZ(0,"app-storage-page")(1,"app-storage-toolbar")(2,"a",0)(3,"mat-icon"),e._uU(4,"arrow_back"),e.qZA()(),e._uU(5),e.qZA(),e.TgZ(6,"div",1),e._UZ(7,"app-bucket-page-tabs",2),e.YNc(8,Se,50,32,"div",3),e.ALo(9,"async"),e.qZA()()),2&n&&(e.xp6(5),e.hij(" ",o.name," "),e.xp6(2),e.Q6J("bucket",o.name),e.xp6(1),e.Q6J("ngIf",e.lcZ(9,3,o.bucket$)))},dependencies:[h.O5,p.rH,k.o6,x.Hw,q,A,P,h.Ov,u.id,u.bP,u.mc],styles:[".progress[_ngcontent-%COMP%]{display:inline-block;width:100px;position:relative;text-align:center;margin-right:5px;background-color:#eee;border:1px solid rgba(0,0,0,.1)}.fill[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;width:30%;background-color:#009e87;background:linear-gradient(to bottom,#009e87,#bce3dd 50%,#009e87)}.label[_ngcontent-%COMP%]{position:absolute;inset:0;margin:0 auto}"],changeDetection:0})}return a})();var C=l(3566);let De=(()=>{class a{constructor(t,n,o,c,s){this.dialogRef=t,this.data=c,this.messageService=s,this.storageClient=o.createStorageClient(),this.form=n.group({name:["",d.kI.required]})}save(){this.storageClient.createBucket({name:this.form.value.name}).then(()=>this.dialogRef.close(!0)).catch(t=>{this.dialogRef.close(!1),this.messageService.showError(t)})}static#e=this.\u0275fac=function(n){return new(n||a)(e.Y36(m.so),e.Y36(d.QS),e.Y36(u.C8),e.Y36(m.WI),e.Y36(u.ez))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["app-create-bucket-dialog"]],decls:12,vars:2,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"ya-form",3,"formGroup"],["type","text","formControlName","name"],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"disabled","click"]],template:function(n,o){1&n&&(e.TgZ(0,"h2",0),e._uU(1,"Create bucket"),e.qZA(),e.TgZ(2,"mat-dialog-content",1)(3,"form",2)(4,"label"),e._uU(5," Bucket name "),e._UZ(6,"input",3),e.qZA()()(),e.TgZ(7,"mat-dialog-actions",4)(8,"button",5),e._uU(9,"CANCEL"),e.qZA(),e.TgZ(10,"button",6),e.NdJ("click",function(){return o.save()}),e._uU(11,"SAVE"),e.qZA()()),2&n&&(e.xp6(3),e.Q6J("formGroup",o.form),e.xp6(7),e.Q6J("disabled",!o.form.valid))},dependencies:[d._Y,d.Fj,d.JJ,d.JL,d.sg,d.u,m.ZT,m.uh,m.xY,m.H8],encapsulation:2})}return a})();var Je=l(4518);function Ne(a,i){if(1&a){const t=e.EpF();e.TgZ(0,"button",26),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.createBucket())}),e.TgZ(1,"mat-icon"),e._uU(2,"add_circle_outline"),e.qZA(),e._uU(3," Create bucket "),e.qZA()}}function Ye(a,i){if(1&a){const t=e.EpF();e.TgZ(0,"button",27),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.deleteSelectedBuckets())}),e.TgZ(1,"mat-icon"),e._uU(2,"delete"),e.qZA(),e._uU(3," Delete "),e.qZA()}if(2&a){const t=e.oxw();e.Q6J("disabled",!t.selection.hasValue())}}function Qe(a,i){if(1&a){const t=e.EpF();e.TgZ(0,"input",30),e.NdJ("change",function(o){e.CHM(t);const c=e.oxw(2);return e.KtG(o?c.masterToggle():null)}),e.qZA()}if(2&a){const t=e.oxw(2);e.Q6J("checked",t.selection.hasValue()&&t.isAllSelected())}}function Me(a,i){if(1&a&&(e.TgZ(0,"th",28),e.YNc(1,Qe,1,1,"input",29),e.qZA()),2&a){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.mayManageBuckets())}}function $e(a,i){if(1&a){const t=e.EpF();e.TgZ(0,"input",33),e.NdJ("click",function(o){return o.stopPropagation()})("change",function(o){e.CHM(t);const c=e.oxw().$implicit,s=e.oxw();return e.KtG(o?s.selection.toggle(c):null)}),e.qZA()}if(2&a){const t=e.oxw().$implicit,n=e.oxw();e.Q6J("checked",n.selection.isSelected(t))}}function Le(a,i){if(1&a&&(e.TgZ(0,"td",31),e.YNc(1,$e,1,1,"input",32),e.qZA()),2&a){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.mayManageBuckets())}}function Fe(a,i){1&a&&(e.TgZ(0,"th",34),e._uU(1,"Bucket"),e.qZA())}const ze=function(a){return[a]};function Ie(a,i){if(1&a&&(e.TgZ(0,"td",35)(1,"mat-icon",36),e._uU(2,"shopping_basket"),e.qZA(),e.TgZ(3,"a",37),e.NdJ("click",function(n){return n.stopPropagation()}),e._uU(4),e.qZA()()),2&a){const t=i.$implicit;e.xp6(3),e.Q6J("routerLink",e.VKq(2,ze,t.name)),e.xp6(1),e.Oqu(t.name)}}function Re(a,i){1&a&&(e.TgZ(0,"th",34),e._uU(1,"Created"),e.qZA())}function He(a,i){if(1&a&&(e.TgZ(0,"td",35),e._uU(1),e.ALo(2,"nvl"),e.ALo(3,"datetime"),e.qZA()),2&a){const t=i.$implicit;e.xp6(1),e.Oqu(e.xi3(2,1,e.lcZ(3,4,t.created),"-"))}}function Ee(a,i){1&a&&(e.TgZ(0,"th",38),e._uU(1,"Used"),e.qZA())}function Ge(a,i){if(1&a&&(e.TgZ(0,"td",39),e._uU(1),e.ALo(2,"nvl"),e.ALo(3,"formatBytes"),e.qZA()),2&a){const t=i.$implicit;e.xp6(1),e.Oqu(e.xi3(2,1,e.lcZ(3,4,t.size),"-"))}}function We(a,i){1&a&&(e.TgZ(0,"th",38),e._uU(1,"Available"),e.qZA())}function Xe(a,i){if(1&a&&(e.TgZ(0,"td",39),e._uU(1),e.ALo(2,"nvl"),e.ALo(3,"formatBytes"),e.qZA()),2&a){const t=i.$implicit,n=e.oxw();e.xp6(1),e.hij(" ",e.xi3(2,1,e.lcZ(3,4,n.zeroOrMore(t.maxSize-t.size)),"-")," ")}}function Ve(a,i){1&a&&(e.TgZ(0,"th",40),e._uU(1,"Capacity"),e.qZA())}function Ke(a,i){if(1&a&&(e.TgZ(0,"td",35),e._UZ(1,"ya-progress",41),e.qZA()),2&a){const t=i.$implicit;e.xp6(1),e.Q6J("value",t.size)("total",t.maxSize)}}function et(a,i){1&a&&(e.TgZ(0,"th",38),e._uU(1,"Objects"),e.qZA())}function tt(a,i){if(1&a&&(e.TgZ(0,"td",39),e._uU(1),e.ALo(2,"nvl"),e.ALo(3,"number"),e.qZA()),2&a){const t=i.$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,e.lcZ(3,4,t.numObjects),"-")," ")}}function at(a,i){1&a&&(e.TgZ(0,"th",38),e._uU(1,"Avail. objects"),e.qZA())}function nt(a,i){if(1&a&&(e.TgZ(0,"td",39),e._uU(1),e.ALo(2,"nvl"),e.ALo(3,"number"),e.qZA()),2&a){const t=i.$implicit,n=e.oxw();e.xp6(1),e.hij(" ",e.xi3(2,1,e.lcZ(3,4,n.zeroOrMore(t.maxObjects-t.numObjects)),"-")," ")}}function ot(a,i){1&a&&(e.TgZ(0,"th",40),e._uU(1,"%objects"),e.qZA())}function ct(a,i){if(1&a&&(e.TgZ(0,"td",35),e._UZ(1,"ya-progress",41),e.qZA()),2&a){const t=i.$implicit;e.xp6(1),e.Q6J("value",t.numObjects)("total",t.maxObjects)}}function it(a,i){1&a&&e._UZ(0,"th",42)}function st(a,i){if(1&a){const t=e.EpF();e.TgZ(0,"ya-more")(1,"button",44),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,c=e.oxw();return e.KtG(c.deleteBucket(o))}),e._uU(2," Delete bucket "),e.qZA()()}}function rt(a,i){if(1&a&&(e.TgZ(0,"td",35),e.YNc(1,st,3,0,"ya-more",43),e.qZA()),2&a){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.mayManageBuckets())}}function lt(a,i){1&a&&e._UZ(0,"tr",45)}function ut(a,i){if(1&a){const t=e.EpF();e.TgZ(0,"tr",46),e.NdJ("click",function(){const c=e.CHM(t).$implicit,s=e.oxw();return e.KtG(s.toggleOne(c))}),e.qZA()}if(2&a){const t=i.$implicit,n=e.oxw();e.ekj("selected",n.selection.isSelected(t))}}const dt=[{path:"",canActivate:[O.r,M.h],canActivateChild:[O.q],runGuardsAndResolvers:"always",component:$,children:[{path:"",pathMatch:"full",redirectTo:"buckets"},{path:"buckets",children:[{path:"",pathMatch:"full",component:(()=>{class a{constructor(t,n,o,c,s,r,f){this.yamcs=t,this.dialog=n,this.router=o,this.route=c,this.messageService=s,this.authService=r,this.filterControl=new d.p4,this.displayedColumns=["select","name","created","size","avail","capacity","numObjects","availObjects","pctObjects","actions"],this.dataSource=new g.by,this.selection=new U.Ov(!0,[]),f.setTitle("Buckets"),this.storageClient=this.yamcs.createStorageClient(),this.initializeOptions(),this.refreshView()}ngAfterViewInit(){this.dataSource.sort=this.sort}initializeOptions(){const t=this.route.snapshot.queryParamMap;t.has("filter")&&(this.filterControl.setValue(t.get("filter")),this.dataSource.filter=t.get("filter").toLowerCase()),this.filterControl.valueChanges.subscribe(()=>{this.updateURL(),this.dataSource.filter=(this.filterControl.value||"").toLowerCase();for(const o of this.selection.selected)-1===this.dataSource.filteredData.indexOf(o)&&this.selection.deselect(o)})}isAllSelected(){const n=this.dataSource.filteredData.length;return this.selection.selected.length===n&&n>0}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.filteredData.forEach(t=>this.selection.select(t))}toggleOne(t){(!this.selection.isSelected(t)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(t)}createBucket(){this.dialog.open(De,{width:"400px"}).afterClosed().subscribe(n=>{n&&this.refreshView()})}zeroOrMore(t){return Math.max(0,t)}mayManageBuckets(){return this.authService.getUser().hasSystemPrivilege("ManageAnyBucket")}deleteSelectedBuckets(){if(confirm("Are you sure you want to delete the selected buckets?")){const t=[];for(const n of this.selection.selected){const o=this.storageClient.deleteBucket(n.name);t.push(o)}Promise.all(t).then(()=>{this.selection.clear(),this.refreshView()})}}deleteBucket(t){confirm(`Are you sure you want to delete the bucket ${t.name}?`)&&this.storageClient.deleteBucket(t.name).then(()=>{this.selection.clear(),this.refreshView()}).catch(n=>this.messageService.showError(n))}selectNext(){const t=this.dataSource.filteredData;let n=0;if(this.selection.hasValue()){const o=this.selection.selected[this.selection.selected.length-1];-1!==t.indexOf(o)&&(n=Math.min(t.indexOf(o)+1,t.length-1))}this.selection.clear(),this.selection.select(t[n])}selectPrevious(){const t=this.dataSource.filteredData;let n=0;if(this.selection.hasValue()){const o=this.selection.selected[0];-1!==t.indexOf(o)&&(n=Math.max(t.indexOf(o)-1,0))}this.selection.clear(),this.selection.select(t[n])}applySelection(){this.selection.hasValue()&&1===this.selection.selected.length&&this.router.navigate(["/buckets",this.selection.selected[0].name])}refreshView(){this.updateURL(),this.storageClient.getBuckets().then(t=>{this.dataSource.data=t}).catch(t=>this.messageService.showError(t))}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{filter:this.filterControl.value||null},queryParamsHandling:"merge"})}static#e=this.\u0275fac=function(n){return new(n||a)(e.Y36(u.C8),e.Y36(m.uw),e.Y36(p.F0),e.Y36(p.gz),e.Y36(u.ez),e.Y36(Je.e),e.Y36(T.Dx))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["ng-component"]],viewQuery:function(n,o){if(1&n&&e.Gf(C.YE,7),2&n){let c;e.iGM(c=e.CRH())&&(o.sort=c.first)}},decls:41,vars:6,consts:[["mat-button","","color","primary",3,"click",4,"ngIf"],["mat-button","","color","primary",3,"disabled","click",4,"ngIf"],[1,"panel-content"],[1,"filter-bar"],["placeholder","Filter buckets",3,"formControl","onArrowDown","onArrowUp","onEnter"],["mat-table","","matSort","","matSortActive","name","matSortDirection","asc","matSortDisableClear","",1,"ya-data-table","expand",3,"dataSource"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",4,"cdkCellDef"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","created"],["matColumnDef","size"],["mat-header-cell","","mat-sort-header","","style","text-align: right",4,"matHeaderCellDef"],["mat-cell","","style","text-align: right",4,"matCellDef"],["matColumnDef","avail"],["matColumnDef","capacity"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","numObjects"],["matColumnDef","availObjects"],["matColumnDef","pctObjects"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","click",4,"matRowDef","matRowDefColumns"],["mat-button","","color","primary",3,"click"],["mat-button","","color","primary",3,"disabled","click"],["mat-header-cell","",1,"checkbox"],["type","checkbox",3,"checked","change",4,"ngIf"],["type","checkbox",3,"checked","change"],["mat-cell","",1,"checkbox"],["type","checkbox",3,"checked","click","change",4,"ngIf"],["type","checkbox",3,"checked","click","change"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"icon12",2,"vertical-align","middle","margin-right","7px"],[3,"routerLink","click"],["mat-header-cell","","mat-sort-header","",2,"text-align","right"],["mat-cell","",2,"text-align","right"],["mat-header-cell",""],[3,"value","total"],["mat-header-cell","",1,"expand"],[4,"ngIf"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(n,o){1&n&&(e.TgZ(0,"app-storage-page")(1,"app-storage-toolbar"),e._uU(2," Storage \xa0\xa0\xa0 "),e.YNc(3,Ne,4,0,"button",0),e.YNc(4,Ye,4,1,"button",1),e.qZA(),e.TgZ(5,"div",2)(6,"div",3)(7,"ya-search-filter",4),e.NdJ("onArrowDown",function(){return o.selectNext()})("onArrowUp",function(){return o.selectPrevious()})("onEnter",function(){return o.applySelection()}),e.qZA()(),e.TgZ(8,"table",5),e.ynx(9,6),e.YNc(10,Me,2,1,"th",7),e.YNc(11,Le,2,1,"td",8),e.BQk(),e.ynx(12,9),e.YNc(13,Fe,2,0,"th",10),e.YNc(14,Ie,5,4,"td",11),e.BQk(),e.ynx(15,12),e.YNc(16,Re,2,0,"th",10),e.YNc(17,He,4,6,"td",11),e.BQk(),e.ynx(18,13),e.YNc(19,Ee,2,0,"th",14),e.YNc(20,Ge,4,6,"td",15),e.BQk(),e.ynx(21,16),e.YNc(22,We,2,0,"th",14),e.YNc(23,Xe,4,6,"td",15),e.BQk(),e.ynx(24,17),e.YNc(25,Ve,2,0,"th",18),e.YNc(26,Ke,2,2,"td",11),e.BQk(),e.ynx(27,19),e.YNc(28,et,2,0,"th",14),e.YNc(29,tt,4,6,"td",15),e.BQk(),e.ynx(30,20),e.YNc(31,at,2,0,"th",14),e.YNc(32,nt,4,6,"td",15),e.BQk(),e.ynx(33,21),e.YNc(34,ot,2,0,"th",18),e.YNc(35,ct,2,2,"td",11),e.BQk(),e.ynx(36,22),e.YNc(37,it,1,0,"th",23),e.YNc(38,rt,2,1,"td",11),e.BQk(),e.YNc(39,lt,1,0,"tr",24),e.YNc(40,ut,1,2,"tr",25),e.qZA()()()),2&n&&(e.xp6(3),e.Q6J("ngIf",o.mayManageBuckets()),e.xp6(1),e.Q6J("ngIf",o.mayManageBuckets()),e.xp6(3),e.Q6J("formControl",o.filterControl),e.xp6(1),e.Q6J("dataSource",o.dataSource),e.xp6(31),e.Q6J("matHeaderRowDef",o.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",o.displayedColumns))},dependencies:[h.O5,d.JJ,d.oH,p.rH,_.O_,_.D5,_.fo,k.lW,x.Hw,j.OP,C.YE,C.nU,g.BZ,g.fO,g.as,g.w1,g.Dz,g.nj,g.ge,g.ev,g.XQ,g.Gk,u.cQ,u.t1,u.cF,A,P,h.JJ,u.id,u.bP,u.mc],encapsulation:2,changeDetection:0})}return a})(),data:{hasSidebar:!1}},{path:":name",children:[{path:"",pathMatch:"full",redirectTo:"objects"},{path:"objects",component:J,children:[{path:"**",component:D,data:{hasSidebar:!1}}]},{path:"properties",component:N,data:{hasSidebar:!1}}]}]}]}];let mt=(()=>{class a{static#e=this.\u0275fac=function(n){return new(n||a)};static#t=this.\u0275mod=e.oAB({type:a});static#a=this.\u0275inj=e.cJS({imports:[p.Bz.forChild(dt),p.Bz]})}return a})(),gt=(()=>{class a{static#e=this.\u0275fac=function(n){return new(n||a)};static#t=this.\u0275mod=e.oAB({type:a});static#a=this.\u0275inj=e.cJS({imports:[Q.m,mt]})}return a})()}}]);