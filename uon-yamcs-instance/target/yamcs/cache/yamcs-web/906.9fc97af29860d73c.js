"use strict";(self.webpackChunkwebapp=self.webpackChunkwebapp||[]).push([[906],{1906:(Wt,v,r)=>{r.r(v),r.d(v,{GapsModule:()=>Xt});var D=r(7216),h=r(1896),R=r(3906),P=r(7914),N=r(4529),p=r(9538),c=r(6516),f=r(5619),t=r(5879),k=r(6593),_=r(6814),Z=r(2296),q=r(617),b=r(3422),S=r(858),y=r(4104);const w=function(){return{matrixParams:"exact",paths:"exact",queryParams:"ignored"}},A=function(e){return{c:e}};let C=(()=>{class e{constructor(a){this.yamcs=a}static#t=this.\u0275fac=function(s){return new(s||e)(t.Y36(c.C8))};static#e=this.\u0275cmp=t.Xpm({type:e,selectors:[["app-gaps-page-tabs"]],decls:10,vars:12,consts:[["mat-tab-nav-bar","",1,"secondary",3,"mat-stretch-tabs","tabPanel"],["mat-tab-link","","routerLink","/gaps","routerLinkActive","",3,"routerLinkActiveOptions","active","queryParams"],["rla","routerLinkActive"],["mat-tab-link","","routerLink","/gaps/requests","routerLinkActive","",3,"active","queryParams"],["rlb","routerLinkActive"],["tabPanel",""]],template:function(s,n){if(1&s&&(t.TgZ(0,"nav",0)(1,"a",1,2),t._uU(3," GAPS "),t.qZA(),t.TgZ(4,"a",3,4),t._uU(6," REQUESTS "),t.qZA()(),t.TgZ(7,"mat-tab-nav-panel",null,5),t._UZ(9,"router-outlet"),t.qZA()),2&s){const o=t.MAs(2),u=t.MAs(5),m=t.MAs(8);t.Q6J("mat-stretch-tabs",!1)("tabPanel",m),t.xp6(1),t.Q6J("routerLinkActiveOptions",t.DdM(7,w))("active",o.isActive)("queryParams",t.VKq(8,A,n.yamcs.context)),t.xp6(3),t.Q6J("active",u.isActive)("queryParams",t.VKq(10,A,n.yamcs.context))}},dependencies:[h.lC,h.rH,h.Od,y.BU,y.sW,y.Nj],styles:[".mat-mdc-tab-link[_ngcontent-%COMP%]{height:36px;min-width:0;font-size:13px}"],changeDetection:0})}return e})();var Y=r(7889);function Q(e,i){if(1&e&&(t.ynx(0),t._uU(1),t.ALo(2,"duration"),t.BQk()),2&e){const a=i.ngIf;t.xp6(1),t.hij("Each ",t.lcZ(2,1,a),"")}}function J(e,i){1&e&&(t.ynx(0),t._uU(1,"-"),t.BQk())}function O(e,i){1&e&&(t.TgZ(0,"th",21),t._uU(1,"Request time"),t.qZA())}function $(e,i){if(1&e&&(t.TgZ(0,"td",22),t._uU(1),t.ALo(2,"ago"),t.qZA()),2&e){const a=i.$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,a.requestTime))}}function I(e,i){1&e&&(t.TgZ(0,"th",21),t._uU(1,"Range start"),t.qZA())}function M(e,i){if(1&e&&(t.TgZ(0,"td",22),t._uU(1),t.ALo(2,"datetime"),t.qZA()),2&e){const a=i.$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,a.start))}}function L(e,i){1&e&&(t.TgZ(0,"th",21),t._uU(1,"Range stop"),t.qZA())}function B(e,i){if(1&e&&(t.TgZ(0,"td",22),t._uU(1),t.ALo(2,"datetime"),t.qZA()),2&e){const a=i.$implicit;t.xp6(1),t.Oqu(t.lcZ(2,1,a.stop))}}function H(e,i){1&e&&(t.TgZ(0,"th",21),t._uU(1,"APID"),t.qZA())}function F(e,i){if(1&e&&(t.TgZ(0,"td",22),t._uU(1),t.qZA()),2&e){const a=i.$implicit;t.xp6(1),t.Oqu(a.apid||"-")}}function E(e,i){1&e&&(t.TgZ(0,"th",21),t._uU(1,"Vehicle"),t.qZA())}function j(e,i){1&e&&(t.ynx(0),t._uU(1,"ISS/USOS"),t.BQk())}function V(e,i){1&e&&(t.ynx(0),t._uU(1,"ISS/RS"),t.BQk())}function X(e,i){1&e&&(t.ynx(0),t._uU(1,"ISS/Columbus"),t.BQk())}function z(e,i){if(1&e&&(t.ynx(0),t._uU(1),t.BQk()),2&e){const a=t.oxw().$implicit;t.xp6(1),t.Oqu(a.vehicle||"-")}}function K(e,i){if(1&e&&(t.TgZ(0,"td",22),t.ynx(1,23),t.YNc(2,j,2,0,"ng-container",24),t.YNc(3,V,2,0,"ng-container",24),t.YNc(4,X,2,0,"ng-container",24),t.YNc(5,z,2,1,"ng-container",25),t.BQk(),t.qZA()),2&e){const a=i.$implicit;t.xp6(1),t.Q6J("ngSwitch",a.vehicle),t.xp6(1),t.Q6J("ngSwitchCase",0),t.xp6(1),t.Q6J("ngSwitchCase",1),t.xp6(1),t.Q6J("ngSwitchCase",2)}}function W(e,i){1&e&&(t.TgZ(0,"th",21),t._uU(1,"Packet type"),t.qZA())}function tt(e,i){1&e&&(t.ynx(0),t._uU(1,"Core"),t.BQk())}function et(e,i){1&e&&(t.ynx(0),t._uU(1,"Payload"),t.BQk())}function at(e,i){if(1&e&&(t.ynx(0),t._uU(1),t.BQk()),2&e){const a=t.oxw().$implicit;t.xp6(1),t.Oqu(a.packetType||"-")}}function it(e,i){if(1&e&&(t.TgZ(0,"td",22),t.ynx(1,23),t.YNc(2,tt,2,0,"ng-container",24),t.YNc(3,et,2,0,"ng-container",24),t.YNc(4,at,2,1,"ng-container",25),t.BQk(),t.qZA()),2&e){const a=i.$implicit;t.xp6(1),t.Q6J("ngSwitch",a.packetType),t.xp6(1),t.Q6J("ngSwitchCase",0),t.xp6(1),t.Q6J("ngSwitchCase",1)}}function nt(e,i){1&e&&(t.TgZ(0,"th",21),t._uU(1,"User"),t.qZA())}function st(e,i){if(1&e&&(t.TgZ(0,"td",22),t._uU(1),t.qZA()),2&e){const a=i.$implicit;t.xp6(1),t.Oqu(a.user||"-")}}function ot(e,i){1&e&&(t.TgZ(0,"th",21),t._uU(1,"Status"),t.qZA())}function lt(e,i){if(1&e&&(t.TgZ(0,"td",22),t._uU(1),t.qZA()),2&e){const a=i.$implicit;t.xp6(1),t.Oqu(a.status||"-")}}function ct(e,i){1&e&&(t.TgZ(0,"th",21),t._uU(1,"Received"),t.qZA())}function rt(e,i){if(1&e&&(t.TgZ(0,"td",22),t._uU(1),t.qZA()),2&e){const a=i.$implicit;t.xp6(1),t.Oqu(a.tmCount)}}function pt(e,i){1&e&&(t.TgZ(0,"th",21),t._uU(1,"PHS"),t.qZA())}function ut(e,i){if(1&e&&(t.TgZ(0,"td",22),t._uU(1),t.qZA()),2&e){const a=i.$implicit;t.xp6(1),t.Oqu(a.privateHeaderSource||"-")}}function mt(e,i){1&e&&t._UZ(0,"th",26)}function dt(e,i){1&e&&t._UZ(0,"td",22)}function gt(e,i){1&e&&t._UZ(0,"tr",27)}function _t(e,i){1&e&&t._UZ(0,"tr",28)}let U=(()=>{class e{constructor(a,s,n){this.yamcs=a,this.messageService=s,this.displayedColumns=["requestTime","user","vehicle","packetType","apid","privateHeaderSource","start","stop","status","tmCount","actions"],this.interval$=new f.X(null),this.period$=new f.X(null),this.dataSource=new p.by,n.setTitle("Playback requests"),this.loadData()}loadData(){this.yamcs.yamcsClient.getLinks(this.yamcs.instance).then(a=>{let s=null;for(const n of a)if(-1!==n.type.indexOf("DassPlaybackPacketProvider")){s=n.name;break}s&&this.yamcs.yamcsClient.getPlaybackInfo(this.yamcs.instance,s).then(n=>{this.interval$.next(n.interval?c.P6.convertProtoDurationToMillis(n.interval):null),this.period$.next(n.period?c.P6.convertProtoDurationToMillis(n.period):null),this.dataSource.data=n.requests||[]}).catch(n=>this.messageService.showError(n))}).catch(a=>this.messageService.showError(a))}static#t=this.\u0275fac=function(s){return new(s||e)(t.Y36(c.C8),t.Y36(c.ez),t.Y36(k.Dx))};static#e=this.\u0275cmp=t.Xpm({type:e,selectors:[["ng-component"]],decls:58,vars:14,consts:[["mat-icon-button","","color","primary",3,"click"],[1,"panel-content"],[1,"dl-horizontal"],[4,"ngIf"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","requestTime"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","start"],["matColumnDef","stop"],["matColumnDef","apid"],["matColumnDef","vehicle"],["matColumnDef","packetType"],["matColumnDef","user"],["matColumnDef","status"],["matColumnDef","tmCount"],["matColumnDef","privateHeaderSource"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""]],template:function(s,n){1&s&&(t.TgZ(0,"app-instance-page")(1,"app-instance-toolbar"),t._uU(2," Playback requests \xa0\xa0\xa0 "),t.TgZ(3,"button",0),t.NdJ("click",function(){return n.loadData()}),t.TgZ(4,"mat-icon"),t._uU(5,"refresh"),t.qZA()()(),t.TgZ(6,"div",1),t._UZ(7,"app-gaps-page-tabs"),t.TgZ(8,"dl",2)(9,"dt"),t._uU(10,"Automated playback:"),t.qZA(),t.TgZ(11,"dd"),t.YNc(12,Q,3,3,"ng-container",3),t.ALo(13,"async"),t.YNc(14,J,2,0,"ng-container",3),t.ALo(15,"async"),t.qZA(),t.TgZ(16,"dt"),t._uU(17,"Lookback period:"),t.qZA(),t.TgZ(18,"dd"),t._uU(19),t.ALo(20,"duration"),t.ALo(21,"async"),t.qZA()(),t.TgZ(22,"table",4),t.ynx(23,5),t.YNc(24,O,2,0,"th",6),t.YNc(25,$,3,3,"td",7),t.BQk(),t.ynx(26,8),t.YNc(27,I,2,0,"th",6),t.YNc(28,M,3,3,"td",7),t.BQk(),t.ynx(29,9),t.YNc(30,L,2,0,"th",6),t.YNc(31,B,3,3,"td",7),t.BQk(),t.ynx(32,10),t.YNc(33,H,2,0,"th",6),t.YNc(34,F,2,1,"td",7),t.BQk(),t.ynx(35,11),t.YNc(36,E,2,0,"th",6),t.YNc(37,K,6,4,"td",7),t.BQk(),t.ynx(38,12),t.YNc(39,W,2,0,"th",6),t.YNc(40,it,5,3,"td",7),t.BQk(),t.ynx(41,13),t.YNc(42,nt,2,0,"th",6),t.YNc(43,st,2,1,"td",7),t.BQk(),t.ynx(44,14),t.YNc(45,ot,2,0,"th",6),t.YNc(46,lt,2,1,"td",7),t.BQk(),t.ynx(47,15),t.YNc(48,ct,2,0,"th",6),t.YNc(49,rt,2,1,"td",7),t.BQk(),t.ynx(50,16),t.YNc(51,pt,2,0,"th",6),t.YNc(52,ut,2,1,"td",7),t.BQk(),t.ynx(53,17),t.YNc(54,mt,1,0,"th",18),t.YNc(55,dt,1,0,"td",7),t.BQk(),t.YNc(56,gt,1,0,"tr",19),t.YNc(57,_t,1,0,"tr",20),t.qZA()()()),2&s&&(t.xp6(12),t.Q6J("ngIf",t.lcZ(13,6,n.interval$)),t.xp6(2),t.Q6J("ngIf",!t.lcZ(15,8,n.interval$)),t.xp6(5),t.hij(" ",t.lcZ(20,10,t.lcZ(21,12,n.period$))||"-"," "),t.xp6(3),t.Q6J("dataSource",n.dataSource),t.xp6(34),t.Q6J("matHeaderRowDef",n.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",n.displayedColumns))},dependencies:[_.O5,_.RF,_.n9,_.ED,Z.RK,q.Hw,p.BZ,p.fO,p.as,p.w1,p.Dz,p.nj,p.ge,p.ev,p.XQ,p.Gk,b.a,S.k,C,_.Ov,c.id,c.uG,Y.n],encapsulation:2,changeDetection:0})}return e})();var ht=r(8337),l=r(6223),d=r(7700);let ft=(()=>{class e{constructor(a,s,n){this.dialogRef=a,this.yamcs=s,this.data=n,this.linkOptions$=new f.X([]),this.form=new l.nJ({mergeTolerance:new l.p4(30),link:new l.p4("",l.kI.required)}),this.gaps=this.data.gaps,this.yamcs.yamcsClient.getLinks(s.instance).then(o=>{const u=[];for(const m of o)-1!==m.type.indexOf("DassPlaybackPacketProvider")&&u.push({id:m.name,label:m.name});this.linkOptions$.next(u),u.length&&this.form.get("link").setValue(u[0].id)})}sendRequest(){const a=[],s=new Map,n=60*this.form.value.mergeTolerance*1e3;this.gaps.sort((o,u)=>o.start.localeCompare(u.start));for(const o of this.gaps){const u=s.get(o.apid);if(u&&this.toMillis(o.start)-this.toMillis(u.stop)<n)u.stop=o.stop;else{const m={apid:o.apid,start:o.start,stop:o.stop};a.push(m),s.set(o.apid,m)}}this.dialogRef.close({link:this.form.value.link,ranges:a})}toMillis(a){return c.P6.toDate(a).getTime()}static#t=this.\u0275fac=function(s){return new(s||e)(t.Y36(d.so),t.Y36(c.C8),t.Y36(d.WI))};static#e=this.\u0275cmp=t.Xpm({type:e,selectors:[["ng-component"]],decls:21,vars:6,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"ya-form",3,"formGroup"],["type","number","formControlName","mergeTolerance"],[1,"hint"],["formControlName","link",3,"options"],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"disabled","click"]],template:function(s,n){1&s&&(t.TgZ(0,"h2",0),t._uU(1),t.qZA(),t.TgZ(2,"mat-dialog-content",1)(3,"form",2)(4,"label"),t._uU(5," Merge tolerance (minutes) "),t._UZ(6,"input",3),t.TgZ(7,"span",4),t._uU(8,"Gaps that are at least this close to each other, are merged into a single request."),t.qZA()(),t._UZ(9,"br"),t.TgZ(10,"label"),t._uU(11," DaSS link "),t._UZ(12,"ya-select",5),t.ALo(13,"async"),t.TgZ(14,"span",4),t._uU(15,"This link will send out the request, and handle data reception."),t.qZA()()()(),t.TgZ(16,"mat-dialog-actions",6)(17,"button",7),t._uU(18,"CANCEL"),t.qZA(),t.TgZ(19,"button",8),t.NdJ("click",function(){return n.sendRequest()}),t._uU(20,"SEND REQUEST"),t.qZA()()),2&s&&(t.xp6(1),t.hij("Request playback of ",n.gaps.length," selected gaps"),t.xp6(2),t.Q6J("formGroup",n.form),t.xp6(9),t.Q6J("options",t.lcZ(13,4,n.linkOptions$)),t.xp6(7),t.Q6J("disabled",!n.form.valid))},dependencies:[l._Y,l.Fj,l.wV,l.JJ,l.JL,l.sg,l.u,d.ZT,d.uh,d.xY,d.H8,c.Hr,_.Ov],encapsulation:2})}return e})(),Tt=(()=>{class e{constructor(a,s,n){this.dialogRef=a,this.yamcs=s,this.data=n,this.linkOptions$=new f.X([]),this.form=new l.nJ({apid:new l.p4("",l.kI.required),start:new l.p4("",l.kI.required),stop:new l.p4("",l.kI.required),link:new l.p4("",l.kI.required)});const o=this.data.gap;o&&this.form.setValue({apid:o.apid,start:o.start,stop:o.stop,link:""}),this.yamcs.yamcsClient.getLinks(s.instance).then(u=>{const m=[];for(const g of u)-1!==g.type.indexOf("DassPlaybackPacketProvider")&&m.push({id:g.name,label:g.name});this.linkOptions$.next(m),m.length&&this.form.get("link").setValue(m[0].id)})}sendRequest(){const a={apid:Number(this.form.value.apid),start:this.form.value.start,stop:this.form.value.stop};this.dialogRef.close({link:this.form.value.link,ranges:[a]})}static#t=this.\u0275fac=function(s){return new(s||e)(t.Y36(d.so),t.Y36(c.C8),t.Y36(d.WI))};static#e=this.\u0275cmp=t.Xpm({type:e,selectors:[["ng-component"]],decls:27,vars:5,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"ya-form",3,"formGroup"],["type","number","formControlName","apid"],["formControlName","start"],["formControlName","stop"],["formControlName","link",3,"options"],[1,"hint"],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"disabled","click"]],template:function(s,n){1&s&&(t.TgZ(0,"h2",0),t._uU(1,"Request playback"),t.qZA(),t.TgZ(2,"mat-dialog-content",1)(3,"form",2)(4,"label"),t._uU(5," APID "),t._UZ(6,"input",3),t.qZA(),t._UZ(7,"br"),t.TgZ(8,"label"),t._uU(9," Start time "),t._UZ(10,"ya-date-time-input",4),t.qZA(),t._UZ(11,"br"),t.TgZ(12,"label"),t._uU(13," Stop time "),t._UZ(14,"ya-date-time-input",5),t.qZA(),t._UZ(15,"br"),t.TgZ(16,"label"),t._uU(17," DaSS link "),t._UZ(18,"ya-select",6),t.ALo(19,"async"),t.TgZ(20,"span",7),t._uU(21,"This link will send out the request, and handle data reception."),t.qZA()()()(),t.TgZ(22,"mat-dialog-actions",8)(23,"button",9),t._uU(24,"CANCEL"),t.qZA(),t.TgZ(25,"button",10),t.NdJ("click",function(){return n.sendRequest()}),t._uU(26,"SEND REQUEST"),t.qZA()()),2&s&&(t.xp6(3),t.Q6J("formGroup",n.form),t.xp6(15),t.Q6J("options",t.lcZ(19,3,n.linkOptions$)),t.xp6(7),t.Q6J("disabled",!n.form.valid))},dependencies:[l._Y,l.Fj,l.wV,l.JJ,l.JL,l.sg,l.u,d.ZT,d.uh,d.xY,d.H8,c.t,c.Hr,_.Ov],encapsulation:2})}return e})();var x=r(4643),Zt=r(7988),yt=r(2596);const xt=["intervalSelect"];function vt(e,i){if(1&e){const a=t.EpF();t.ynx(0),t._UZ(1,"ya-date-time-input",10)(2,"ya-date-time-input",11),t.TgZ(3,"button",12),t.NdJ("click",function(){t.CHM(a);const n=t.oxw();return t.KtG(n.applyCustomDates())}),t._uU(4,"Apply"),t.qZA(),t.BQk()}if(2&e){const a=t.oxw();t.xp6(3),t.Q6J("disabled",a.filterForm.invalid)}}function Pt(e,i){1&e&&(t.TgZ(0,"ya-empty-message"),t._uU(1," No data for the current filter criteria. "),t.qZA())}function kt(e,i){1&e&&(t.TgZ(0,"ya-empty-message"),t._uU(1," Too many results. Please narrow down the request range. "),t.qZA())}function qt(e,i){if(1&e&&(t.ynx(0),t.YNc(1,Pt,2,0,"ya-empty-message",8),t.YNc(2,kt,2,0,"ya-empty-message",8),t.ALo(3,"async"),t.BQk()),2&e){const a=t.oxw();t.xp6(1),t.Q6J("ngIf",!a.dataSource.data.length),t.xp6(1),t.Q6J("ngIf",t.lcZ(3,2,a.hasMore$))}}function bt(e,i){if(1&e){const a=t.EpF();t.TgZ(0,"th",32)(1,"input",33),t.NdJ("change",function(n){t.CHM(a);const o=t.oxw(2);return t.KtG(n?o.masterToggle():null)}),t.qZA()()}if(2&e){const a=t.oxw(2);t.xp6(1),t.Q6J("checked",a.selection.hasValue()&&a.isAllSelected())}}function St(e,i){if(1&e){const a=t.EpF();t.TgZ(0,"td",34)(1,"input",35),t.NdJ("click",function(n){return n.stopPropagation()})("change",function(n){const u=t.CHM(a).$implicit,m=t.oxw(2);return t.KtG(n?m.selection.toggle(u):null)}),t.qZA()()}if(2&e){const a=i.$implicit,s=t.oxw(2);t.xp6(1),t.Q6J("checked",s.selection.isSelected(a))("disabled",!a.start||!a.stop)}}function At(e,i){1&e&&(t.TgZ(0,"th",36),t._uU(1,"APID"),t.qZA())}function Ct(e,i){if(1&e&&(t.TgZ(0,"td",37),t._uU(1),t.qZA()),2&e){const a=i.$implicit;t.xp6(1),t.hij(" ",a.apid," ")}}function Ut(e,i){1&e&&(t.TgZ(0,"th",36),t._uU(1,"Start"),t.qZA())}function Gt(e,i){if(1&e&&(t.TgZ(0,"td",37),t._uU(1),t.ALo(2,"datetime"),t.qZA()),2&e){const a=i.$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,a.start)||"-"," ")}}function Dt(e,i){1&e&&(t.TgZ(0,"th",36),t._uU(1,"Stop"),t.qZA())}function Rt(e,i){if(1&e&&(t.TgZ(0,"td",37),t._uU(1),t.ALo(2,"datetime"),t.qZA()),2&e){const a=i.$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,a.stop)||"-"," ")}}function Nt(e,i){1&e&&(t.TgZ(0,"th",36),t._uU(1,"Start sequence"),t.qZA())}function wt(e,i){if(1&e&&(t.TgZ(0,"td",37),t._uU(1),t.qZA()),2&e){const a=i.$implicit;t.xp6(1),t.hij(" ",a.startSequenceCount||"-"," ")}}function Yt(e,i){1&e&&(t.TgZ(0,"th",36),t._uU(1,"Stop sequence"),t.qZA())}function Qt(e,i){if(1&e&&(t.TgZ(0,"td",37),t._uU(1),t.qZA()),2&e){const a=i.$implicit;t.xp6(1),t.hij(" ",a.stopSequenceCount||"-"," ")}}function Jt(e,i){1&e&&(t.TgZ(0,"th",38),t._uU(1,"Duration"),t.qZA())}function Ot(e,i){if(1&e&&(t.TgZ(0,"td",39),t._uU(1),t.ALo(2,"deltaWith"),t.qZA()),2&e){const a=i.$implicit;t.xp6(1),t.hij(" ",t.Dn7(2,1,a.stop,a.start,!1)||"-"," ")}}function $t(e,i){1&e&&(t.TgZ(0,"th",36),t._uU(1,"Missing packets"),t.qZA())}function It(e,i){if(1&e&&(t.TgZ(0,"td",37),t._uU(1),t.qZA()),2&e){const a=i.$implicit;t.xp6(1),t.hij(" ",a.missingPacketCount||"-"," ")}}function Mt(e,i){1&e&&t._UZ(0,"th",40)}function Lt(e,i){if(1&e){const a=t.EpF();t.TgZ(0,"ya-more")(1,"button",41),t.NdJ("click",function(){t.CHM(a);const n=t.oxw().$implicit,o=t.oxw(2);return t.KtG(o.openPlaybackDialog(n))}),t._uU(2," Request playback "),t.qZA()()}}function Bt(e,i){if(1&e&&(t.TgZ(0,"td",37),t.YNc(1,Lt,3,0,"ya-more",8),t.qZA()),2&e){const a=i.$implicit;t.xp6(1),t.Q6J("ngIf",a.start&&a.stop)}}function Ht(e,i){1&e&&t._UZ(0,"tr",42)}function Ft(e,i){if(1&e){const a=t.EpF();t.TgZ(0,"tr",43),t.NdJ("click",function(){const o=t.CHM(a).$implicit,u=t.oxw(2);return t.KtG(u.toggleOne(o))}),t.qZA()}if(2&e){const a=i.$implicit,s=t.oxw(2);t.ekj("selected",s.selection.isSelected(a))}}function Et(e,i){if(1&e&&(t.TgZ(0,"table",13),t.ynx(1,14),t.YNc(2,bt,2,1,"th",15),t.YNc(3,St,2,2,"td",16),t.BQk(),t.ynx(4,17),t.YNc(5,At,2,0,"th",18),t.YNc(6,Ct,2,1,"td",19),t.BQk(),t.ynx(7,20),t.YNc(8,Ut,2,0,"th",18),t.YNc(9,Gt,3,3,"td",19),t.BQk(),t.ynx(10,21),t.YNc(11,Dt,2,0,"th",18),t.YNc(12,Rt,3,3,"td",19),t.BQk(),t.ynx(13,22),t.YNc(14,Nt,2,0,"th",18),t.YNc(15,wt,2,1,"td",19),t.BQk(),t.ynx(16,23),t.YNc(17,Yt,2,0,"th",18),t.YNc(18,Qt,2,1,"td",19),t.BQk(),t.ynx(19,24),t.YNc(20,Jt,2,0,"th",25),t.YNc(21,Ot,3,5,"td",26),t.BQk(),t.ynx(22,27),t.YNc(23,$t,2,0,"th",18),t.YNc(24,It,2,1,"td",19),t.BQk(),t.ynx(25,28),t.YNc(26,Mt,1,0,"th",29),t.YNc(27,Bt,2,1,"td",19),t.BQk(),t.YNc(28,Ht,1,0,"tr",30),t.YNc(29,Ft,1,2,"tr",31),t.qZA()),2&e){const a=t.oxw();t.Q6J("dataSource",a.dataSource),t.xp6(28),t.Q6J("matHeaderRowDef",a.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",a.displayedColumns)}}const jt=[{path:"",canActivate:[P.r,R._],canActivateChild:[P.q],runGuardsAndResolvers:"always",component:N.K,children:[{path:"",pathMatch:"full",component:(()=>{class e{constructor(a,s,n,o,u,m){this.yamcs=a,this.dialog=n,this.messageService=o,this.router=u,this.route=m,this.filterForm=new l.nJ({apid:new l.p4([]),interval:new l.p4("PT1H",[l.kI.required]),customStart:new l.p4(null),customStop:new l.p4(null)}),this.displayedColumns=["select","start","stop","apid","duration","startSequence","stopSequence","packetCount","actions"],this.apidOptions$=new f.X([]),this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT3H",label:"Last 3 hours"},{id:"PT6H",label:"Last 6 hours"},{id:"PT12H",label:"Last 12 hours"},{id:"P1D",label:"Last 24 hours"},{id:"P2D",label:"Last 48 hours"},{id:"CUSTOM",label:"Custom",group:!0}],this.apid=[],this.dataSource=new p.by,this.selection=new ht.Ov(!0,[]),this.hasMore$=new f.X(!1),s.setTitle("Gaps"),a.yamcsClient.getApids(a.instance).then(g=>{for(const T of g)this.apidOptions$.next([...this.apidOptions$.value,{id:String(T),label:`APID ${T}`}])}),this.initializeOptions(),this.loadData(),this.filterForm.get("apid").valueChanges.forEach(g=>{this.apid=g,this.loadData()}),this.filterForm.get("interval").valueChanges.forEach(g=>{const T=this.yamcs.getMissionTime();if("CUSTOM"===g){const zt=this.validStart||T,Kt=this.validStop||T;this.filterForm.get("customStart").setValue(c.P6.toISOString(zt)),this.filterForm.get("customStop").setValue(c.P6.toISOString(Kt))}else this.validStop=null,this.validStart=c.P6.subtractDuration(T,g),this.appliedInterval=g,this.loadData()})}initializeOptions(){const a=this.route.snapshot.queryParamMap;if(a.has("apid")&&(this.apid=a.getAll("apid"),this.filterForm.get("apid").setValue(this.apid)),a.has("interval"))if(this.appliedInterval=a.get("interval"),this.filterForm.get("interval").setValue(this.appliedInterval),"CUSTOM"===this.appliedInterval){const s=a.get("customStart");this.filterForm.get("customStart").setValue(s),this.validStart=c.P6.toDate(s);const n=a.get("customStop");this.filterForm.get("customStop").setValue(n),this.validStop=c.P6.toDate(n)}else this.validStop=this.yamcs.getMissionTime(),this.validStart=c.P6.subtractDuration(this.validStop,this.appliedInterval);else this.appliedInterval="PT1H",this.validStop=this.yamcs.getMissionTime(),this.validStart=c.P6.subtractDuration(this.validStop,this.appliedInterval)}applyCustomDates(){this.validStart=c.P6.toDate(this.filterForm.value.customStart),this.validStop=c.P6.toDate(this.filterForm.value.customStop),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.selection.clear(),this.updateURL();const a={limit:500};this.validStart&&(a.start=this.validStart.toISOString()),this.validStop&&(a.stop=this.validStop.toISOString()),this.apid.length&&(a.apids=this.apid.map(s=>Number(s))),this.yamcs.yamcsClient.getGaps(this.yamcs.instance,a).then(s=>{const n=(s.gaps||[]).sort(c.P6.objectCompareFn("-start","-apid"));this.hasMore$.next(!!s.continuationToken),this.dataSource.data=n}).catch(s=>this.messageService.showError(s))}isAllSelected(){const a=this.selection.selected.length,s=this.dataSource.filteredData.filter(n=>n.start&&n.stop).length;return a===s&&s>0}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{apid:this.apid.length?this.apid:null,interval:this.appliedInterval,customStart:"CUSTOM"===this.appliedInterval?this.filterForm.value.customStart:null,customStop:"CUSTOM"===this.appliedInterval?this.filterForm.value.customStop:null},queryParamsHandling:"merge"})}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.filteredData.forEach(a=>{a.start&&a.stop&&this.selection.select(a)})}toggleOne(a){!a.start||!a.stop||((!this.selection.isSelected(a)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(a))}openPlaybackDialog(a){const s=a?[a]:this.selection.selected;let n;n=s.length<=1?this.dialog.open(Tt,{data:{gap:s[0]},width:"500px"}):this.dialog.open(ft,{data:{gaps:s},width:"500px"}),n.afterClosed().subscribe(o=>{o&&this.yamcs.yamcsClient.requestPlayback(this.yamcs.instance,o.link,{ranges:o.ranges}).then(()=>this.messageService.showInfo("Playback requested")).catch(u=>this.messageService.showError(u))})}static#t=this.\u0275fac=function(s){return new(s||e)(t.Y36(c.C8),t.Y36(k.Dx),t.Y36(d.uw),t.Y36(c.ez),t.Y36(h.F0),t.Y36(h.gz))};static#e=this.\u0275cmp=t.Xpm({type:e,selectors:[["ng-component"]],viewQuery:function(s,n){if(1&s&&t.Gf(xt,5),2&s){let o;t.iGM(o=t.CRH())&&(n.intervalSelect=o.first)}},decls:22,vars:10,consts:[["mat-button","","color","primary",3,"click"],["mat-icon-button","","matTooltip","Reload data","color","primary",3,"click"],[1,"panel-content"],[3,"formGroup"],[1,"filter-bar",2,"margin-top","16px"],["formControlName","apid","emptyOption","Any APID",3,"options"],["icon","access_time","formControlName","interval",3,"options"],["intervalSelect",""],[4,"ngIf"],["mat-table","","class","ya-data-table expand",3,"dataSource",4,"ngIf"],["formControlName","customStart"],["formControlName","customStop"],[1,"ya-button",3,"disabled","click"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",4,"cdkCellDef"],["matColumnDef","apid"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","start"],["matColumnDef","stop"],["matColumnDef","startSequence"],["matColumnDef","stopSequence"],["matColumnDef","duration"],["mat-header-cell","","class","vdiv",4,"matHeaderCellDef"],["mat-cell","","class","vdiv",4,"matCellDef"],["matColumnDef","packetCount"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell","",1,"checkbox"],["type","checkbox",3,"checked","change"],["mat-cell","",1,"checkbox"],["type","checkbox",3,"checked","disabled","click","change"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","",1,"vdiv"],["mat-cell","",1,"vdiv"],["mat-header-cell","",1,"expand"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(s,n){1&s&&(t.TgZ(0,"app-instance-page")(1,"app-instance-toolbar"),t._uU(2," Gaps \xa0\xa0\xa0 "),t.TgZ(3,"button",0),t.NdJ("click",function(){return n.openPlaybackDialog()}),t.TgZ(4,"mat-icon"),t._uU(5,"redo"),t.qZA(),t._uU(6," Request playback "),t.qZA(),t.TgZ(7,"button",1),t.NdJ("click",function(){return n.loadData()}),t.TgZ(8,"mat-icon"),t._uU(9,"refresh"),t.qZA()()(),t.TgZ(10,"div",2),t._UZ(11,"app-gaps-page-tabs"),t.TgZ(12,"form",3)(13,"div",4),t._UZ(14,"ya-multi-select",5),t.ALo(15,"async"),t._UZ(16,"ya-select",6,7),t.YNc(18,vt,5,1,"ng-container",8),t.qZA()(),t.YNc(19,qt,4,4,"ng-container",8),t.YNc(20,Et,30,3,"table",9),t.ALo(21,"async"),t.qZA()()),2&s&&(t.xp6(12),t.Q6J("formGroup",n.filterForm),t.xp6(2),t.Q6J("options",t.lcZ(15,6,n.apidOptions$)),t.xp6(2),t.Q6J("options",n.intervalOptions),t.xp6(2),t.Q6J("ngIf","CUSTOM"===n.filterForm.value.interval),t.xp6(1),t.Q6J("ngIf",n.filterForm.valid),t.xp6(1),t.Q6J("ngIf",!t.lcZ(21,8,n.hasMore$)&&n.dataSource.data.length))},dependencies:[_.O5,l._Y,l.JJ,l.JL,l.sg,l.u,x.O_,x.D5,x.fo,Z.lW,Z.RK,q.Hw,Zt.OP,p.BZ,p.fO,p.as,p.w1,p.Dz,p.nj,p.ge,p.ev,p.XQ,p.Gk,yt.gM,c.t,c.RR,c.cQ,c.OP,c.Hr,b.a,S.k,C,_.Ov,c.id,c.mX],encapsulation:2,changeDetection:0})}return e})()},{path:"requests",component:U}]}];let Vt=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=t.oAB({type:e});static#a=this.\u0275inj=t.cJS({imports:[h.Bz.forChild(jt),h.Bz]})}return e})(),Xt=(()=>{class e{static#t=this.\u0275fac=function(s){return new(s||e)};static#e=this.\u0275mod=t.oAB({type:e});static#a=this.\u0275inj=t.cJS({imports:[D.m,Vt]})}return e})()}}]);