"use strict";(self.webpackChunkwebapp=self.webpackChunkwebapp||[]).push([[926],{3926:($t,y,l)=>{l.r(y),l.d(y,{EventsModule:()=>Dt});var E=l(7216),d=l(1896),w=l(3906),S=l(7914),t=l(5879),x=l(4518);let T=(()=>{class i{constructor(e,n){this.authService=e,this.router=n}canActivate(e,n){return!!this.authService.getUser().hasSystemPrivilege("ReadEvents")||(this.router.navigate(["/403"],{queryParams:{page:n.url}}),!1)}canActivateChild(e,n){return this.canActivate(e,n)}static#t=this.\u0275fac=function(n){return new(n||i)(t.LFG(x.e),t.LFG(d.F0))};static#e=this.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var U=l(4529),r=l(6223),o=l(6516),p=l(5619),O=l(3620),h=l(7700);let N=(()=>{class i{constructor(e,n,a,u){this.dialogRef=e,this.yamcs=a,this.data=u,this.severityOptions=[{id:"INFO",label:"INFO"},{id:"WATCH",label:"WATCH"},{id:"WARNING",label:"WARNING"},{id:"DISTRESS",label:"DISTRESS"},{id:"CRITICAL",label:"CRITICAL"},{id:"SEVERE",label:"SEVERE"}],this.form=n.group({message:["",r.kI.required],severity:"INFO",time:[o.P6.toISOString(a.getMissionTime()),r.kI.required]})}save(){this.yamcs.yamcsClient.createEvent(this.yamcs.instance,{message:this.form.value.message,severity:this.form.value.severity,time:o.P6.toISOString(this.form.value.time)}).then(e=>this.dialogRef.close(e))}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(h.so),t.Y36(r.QS),t.Y36(o.C8),t.Y36(h.WI))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["ng-component"]],decls:21,vars:3,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"ya-form",3,"formGroup"],["formControlName","message","rows","3"],["formControlName","severity",3,"options"],["formControlName","time","step","1"],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"disabled","click"]],template:function(n,a){1&n&&(t.TgZ(0,"h2",0),t._uU(1,"Create event"),t.qZA(),t.TgZ(2,"mat-dialog-content",1)(3,"form",2)(4,"label"),t._uU(5," Message "),t._UZ(6,"textarea",3),t.qZA(),t._UZ(7,"br"),t.TgZ(8,"label"),t._uU(9," Severity"),t._UZ(10,"br")(11,"ya-select",4),t.qZA(),t._UZ(12,"br"),t.TgZ(13,"label"),t._uU(14," Event time "),t._UZ(15,"ya-date-time-input",5),t.qZA()()(),t.TgZ(16,"mat-dialog-actions",6)(17,"button",7),t._uU(18,"CANCEL"),t.qZA(),t.TgZ(19,"button",8),t.NdJ("click",function(){return a.save()}),t._uU(20,"SAVE"),t.qZA()()),2&n&&(t.xp6(3),t.Q6J("formGroup",a.form),t.xp6(8),t.Q6J("options",a.severityOptions),t.xp6(8),t.Q6J("disabled",!a.form.valid))},dependencies:[r._Y,r.Fj,r.JJ,r.JL,r.sg,r.u,h.ZT,h.uh,h.xY,h.H8,o.t,o.Hr],encapsulation:2,changeDetection:0})}return i})();var P=l(8337);class I{constructor(s){this.watermarkObserver=s,this.dirty=!1,this.archiveEvents=[],this.bufferSize=500,this.bufferWatermark=400,this.pointer=0,this.alreadyWarned=!1,this.realtimeBuffer=Array(this.bufferSize).fill(void 0)}addArchiveData(s){this.archiveEvents=this.archiveEvents.concat(s),this.dirty=!0}addRealtimeEvent(s){this.pointer<this.bufferSize&&(this.realtimeBuffer[this.pointer]=s,this.pointer>=this.bufferWatermark&&this.watermarkObserver&&!this.alreadyWarned&&(this.alreadyWarned=!0,this.watermarkObserver()),this.pointer=this.pointer+1),this.dirty=!0}reset(){this.archiveEvents=[],this.realtimeBuffer.fill(void 0),this.pointer=0,this.alreadyWarned=!1,this.dirty=!0}snapshot(){const s=this.realtimeBuffer.filter(n=>void 0!==n);return this.archiveEvents.concat(s).sort((n,a)=>{let u=-n.generationTime.localeCompare(a.generationTime);return 0===u&&(u=-n.source.localeCompare(a.source)),0!==u?u:a.seqNumber-n.seqNumber})}compact(s){const e=this.snapshot();e.length=Math.min(s,e.length),this.reset(),this.archiveEvents=e,this.dirty=!0}}class M extends P.o2{constructor(s,e){super(),this.yamcs=s,this.pageSize=100,this.blockHasMore=!1,this.events$=new p.X([]),this.sources$=new p.X([]),this.loading$=new p.X(!1),this.streaming$=new p.X(!1),this.syncSubscription=e.sync(()=>{if(this.eventBuffer.dirty&&!this.loading$.getValue()){const n=this.eventBuffer.snapshot();this.events$.next(n),this.eventBuffer.dirty=!1}}),this.eventBuffer=new I(()=>{this.blockHasMore=!0,this.eventBuffer.compact(500)})}connect(){return this.events$}loadEvents(s){return this.loading$.next(!0),Promise.all([this.yamcs.yamcsClient.getEventSources(this.yamcs.instance),this.loadPage({...s,limit:this.pageSize+1})]).then(e=>{const n=e[0],a=e[1];return this.loading$.next(!1),this.eventBuffer.reset(),this.blockHasMore=!1,this.eventBuffer.addArchiveData(a),this.sources$.next(n),a})}hasMore(){return null!=this.offscreenRecord&&!this.blockHasMore}loadPage(s){return this.options=s,this.yamcs.yamcsClient.getEvents(this.yamcs.instance,s).then(e=>(e.length>this.pageSize?(e.splice(e.length-1,1),this.offscreenRecord=e[e.length-1]):this.offscreenRecord=null,e))}loadMoreData(s){this.offscreenRecord&&this.loadPage({...s,stop:this.offscreenRecord.generationTime,limit:this.pageSize+1}).then(e=>{this.eventBuffer.addArchiveData(e)})}startStreaming(){this.streaming$.next(!0),this.realtimeSubscription=this.yamcs.yamcsClient.createEventSubscription({instance:this.yamcs.instance},s=>{this.addEventSource(s),!this.loading$.getValue()&&this.matchesFilter(s)&&(s.animate=!0,this.eventBuffer.addRealtimeEvent(s))})}addEventSource(s){if(s.source){for(const e of this.sources$.value)if(e===s.source)return;this.sources$.next([...this.sources$.value,s.source].sort((e,n)=>e.toLowerCase().localeCompare(n.toLocaleLowerCase())))}}matchesFilter(s){if(this.options){if(this.options.source&&s.source!==this.options.source||this.options.q&&-1===s.message.indexOf(this.options.q))return!1;if(this.options.severity)switch(this.options.severity){case"SEVERE":case"ERROR":if("CRITICAL"===s.severity)return!1;case"CRITICAL":if("DISTRESS"===s.severity)return!1;case"DISTRESS":if("WARNING"===s.severity)return!1;case"WARNING":if("WATCH"===s.severity)return!1;case"WATCH":if("INFO"===s.severity)return!1}}return!0}stopStreaming(){this.realtimeSubscription?.cancel(),this.streaming$.next(!1)}disconnect(){this.stopStreaming(),this.syncSubscription?.unsubscribe(),this.events$.complete(),this.sources$.complete(),this.loading$.complete(),this.streaming$.complete()}}var g=l(6814);let k=(()=>{class i{constructor(e,n,a){this.dialogRef=e,this.yamcs=n,this.data=a,this.delimiterOptions=[{id:"COMMA",label:"Comma"},{id:"SEMICOLON",label:"Semicolon"},{id:"TAB",label:"Tab"}],this.downloadURL$=new p.X(null),this.form=new r.nJ({start:new r.p4(null),stop:new r.p4(null),severity:new r.p4(null,r.kI.required),q:new r.p4(null),source:new r.p4([]),delimiter:new r.p4(null,r.kI.required)}),this.form.setValue({start:a.start?o.P6.toISOString(a.start):"",stop:a.stop?o.P6.toISOString(a.stop):"",q:a.q||"",source:a.source,severity:a.severity,delimiter:"TAB"}),this.formChangeSubscription=this.form.valueChanges.subscribe(()=>{this.updateURL()}),this.updateURL()}closeDialog(){this.dialogRef.close(!0)}updateURL(){if(this.form.valid){const e={delimiter:this.form.value.delimiter,severity:this.form.value.severity};this.form.value.start&&(e.start=o.P6.toISOString(this.form.value.start)),this.form.value.stop&&(e.stop=o.P6.toISOString(this.form.value.stop)),this.form.value.q&&(e.q=this.form.value.q),this.form.value.source.length&&(e.source=this.form.value.source);const n=this.yamcs.yamcsClient.getEventsDownloadURL(this.yamcs.instance,e);this.downloadURL$.next(n)}else this.downloadURL$.next(null)}ngOnDestroy(){this.formChangeSubscription&&this.formChangeSubscription.unsubscribe()}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(h.so),t.Y36(o.C8),t.Y36(h.WI))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["ng-component"]],decls:36,vars:9,consts:[["mat-dialog-title",""],[1,"mat-typography","ya-form"],[3,"formGroup"],["formControlName","start"],["formControlName","stop"],["formControlName","severity",3,"options"],["type","text","formControlName","q"],["formControlName","source","emptyOption","Any source",3,"options"],["formControlName","delimiter",3,"options"],["align","end"],["mat-dialog-close","",1,"ya-button"],[3,"link","primary","disabled","click"]],template:function(n,a){1&n&&(t.TgZ(0,"h2",0),t._uU(1,"Export events"),t.qZA(),t.TgZ(2,"mat-dialog-content",1)(3,"form",2)(4,"label"),t._uU(5," Start "),t._UZ(6,"ya-date-time-input",3),t.qZA(),t._UZ(7,"br"),t.TgZ(8,"label"),t._uU(9," Stop "),t._UZ(10,"ya-date-time-input",4),t.qZA(),t._UZ(11,"br"),t.TgZ(12,"label"),t._uU(13," Severity"),t._UZ(14,"br")(15,"ya-select",5),t.qZA(),t._UZ(16,"br"),t.TgZ(17,"label"),t._uU(18," Text filter "),t._UZ(19,"input",6),t.qZA(),t._UZ(20,"br"),t.TgZ(21,"label"),t._uU(22," Source"),t._UZ(23,"br")(24,"ya-multi-select",7),t.qZA(),t._UZ(25,"br"),t.TgZ(26,"label"),t._uU(27," CSV column delimiter"),t._UZ(28,"br")(29,"ya-select",8),t.qZA()()(),t.TgZ(30,"mat-dialog-actions",9)(31,"button",10),t._uU(32,"CANCEL"),t.qZA(),t.TgZ(33,"ya-download-button",11),t.NdJ("click",function(){return a.closeDialog()}),t.ALo(34,"async"),t._uU(35," DOWNLOAD "),t.qZA()()),2&n&&(t.xp6(3),t.Q6J("formGroup",a.form),t.xp6(12),t.Q6J("options",a.data.severityOptions),t.xp6(9),t.Q6J("options",a.data.sourceOptions),t.xp6(5),t.Q6J("options",a.delimiterOptions),t.xp6(4),t.Q6J("link",t.lcZ(34,7,a.downloadURL$))("primary",!0)("disabled",!a.form.valid))},dependencies:[r._Y,r.Fj,r.JJ,r.JL,r.sg,r.u,h.ZT,h.uh,h.xY,h.H8,o.t,o.NA,o.OP,o.Hr,g.Ov],encapsulation:2})}return i})();var J=l(6593),f=l(4643),Z=l(2296),q=l(617),v=l(9538),D=l(1274),Q=l(2596),F=l(3422),R=l(858);function Y(i,s){1&i&&(t.ynx(0),t._uU(1,"-"),t.BQk())}function L(i,s){if(1&i&&t._UZ(0,"ya-highlight",2),2&i){const e=t.oxw();t.Q6J("text",e.summary)("term",e.highlight)}}function $(i,s){if(1&i&&(t.ynx(0),t._UZ(1,"br")(2,"ya-highlight",2),t.BQk()),2&i){const e=t.oxw(2);t.xp6(2),t.Q6J("text",e.detail)("term",e.highlight)}}function B(i,s){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"ya-icon-action",3),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.toggleExpanded())}),t.qZA(),t.YNc(2,$,3,2,"ng-container",0),t.ALo(3,"async"),t.BQk()}if(2&i){const e=t.oxw();t.xp6(2),t.Q6J("ngIf",t.lcZ(3,1,e.expanded$))}}let H=(()=>{class i{constructor(){this.expanded$=new p.X(!1)}ngOnInit(){if(null!=this.message){const e=this.message.indexOf("\n");-1===e?this.summary=this.message:(this.summary=this.message.substring(0,e),e+1<this.message.length&&(this.detail=this.message.substring(e+1)))}}toggleExpanded(){this.expanded$.next(!this.expanded$.value)}static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-event-message"]],inputs:{message:"message",highlight:"highlight"},decls:3,vars:3,consts:[[4,"ngIf"],[3,"text","term",4,"ngIf"],[3,"text","term"],["icon","more_horiz",3,"click"]],template:function(n,a){1&n&&(t.YNc(0,Y,2,0,"ng-container",0),t.YNc(1,L,1,2,"ya-highlight",1),t.YNc(2,B,4,3,"ng-container",0)),2&n&&(t.Q6J("ngIf",null==a.summary),t.xp6(1),t.Q6J("ngIf",null!=a.summary),t.xp6(1),t.Q6J("ngIf",a.detail))},dependencies:[g.O5,o.oQ,o.J5,g.Ov],encapsulation:2,changeDetection:0})}return i})();function G(i,s){if(1&i&&t._UZ(0,"div",8),2&i){const e=t.oxw();t.ekj("grayscale",e.grayscale)}}function W(i,s){if(1&i&&t._UZ(0,"div",9),2&i){const e=t.oxw();t.ekj("grayscale",e.grayscale)}}function j(i,s){if(1&i&&t._UZ(0,"div",10),2&i){const e=t.oxw();t.ekj("grayscale",e.grayscale)}}function V(i,s){if(1&i&&t._UZ(0,"div",11),2&i){const e=t.oxw();t.ekj("grayscale",e.grayscale)}}function z(i,s){if(1&i&&t._UZ(0,"div",12),2&i){const e=t.oxw();t.ekj("grayscale",e.grayscale)}}function X(i,s){if(1&i&&t._UZ(0,"div",13),2&i){const e=t.oxw();t.ekj("grayscale",e.grayscale)}}function K(i,s){if(1&i&&t._UZ(0,"div",14),2&i){const e=t.oxw();t.ekj("grayscale",e.grayscale)}}let tt=(()=>{class i{constructor(){this.grayscale=!1}static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-event-severity"]],inputs:{severity:"severity",grayscale:"grayscale"},decls:8,vars:8,consts:[[3,"ngSwitch"],["class","info",3,"grayscale",4,"ngSwitchCase"],["class","watch",3,"grayscale",4,"ngSwitchCase"],["class","warning",3,"grayscale",4,"ngSwitchCase"],["class","distress",3,"grayscale",4,"ngSwitchCase"],["class","critical",3,"grayscale",4,"ngSwitchCase"],["class","severe",3,"grayscale",4,"ngSwitchCase"],["class","error",3,"grayscale",4,"ngSwitchCase"],[1,"info"],[1,"watch"],[1,"warning"],[1,"distress"],[1,"critical"],[1,"severe"],[1,"error"]],template:function(n,a){1&n&&(t.ynx(0,0),t.YNc(1,G,1,2,"div",1),t.YNc(2,W,1,2,"div",2),t.YNc(3,j,1,2,"div",3),t.YNc(4,V,1,2,"div",4),t.YNc(5,z,1,2,"div",5),t.YNc(6,X,1,2,"div",6),t.YNc(7,K,1,2,"div",7),t.BQk()),2&n&&(t.Q6J("ngSwitch",a.severity),t.xp6(1),t.Q6J("ngSwitchCase","INFO"),t.xp6(1),t.Q6J("ngSwitchCase","WATCH"),t.xp6(1),t.Q6J("ngSwitchCase","WARNING"),t.xp6(1),t.Q6J("ngSwitchCase","DISTRESS"),t.xp6(1),t.Q6J("ngSwitchCase","CRITICAL"),t.xp6(1),t.Q6J("ngSwitchCase","SEVERE"),t.xp6(1),t.Q6J("ngSwitchCase","ERROR"))},dependencies:[g.RF,g.n9],styles:[".info[_ngcontent-%COMP%], .watch[_ngcontent-%COMP%], .warning[_ngcontent-%COMP%], .distress[_ngcontent-%COMP%], .critical[_ngcontent-%COMP%], .severe[_ngcontent-%COMP%], .error[_ngcontent-%COMP%]{display:inline-block;height:5px;width:29px;position:relative;background-image:url(level-sprite.png)}.info[_ngcontent-%COMP%]{background-position:0 0}.watch[_ngcontent-%COMP%]{background-position:0 -5px}.warning[_ngcontent-%COMP%]{background-position:0 -10px}.distress[_ngcontent-%COMP%]{background-position:0 -15px}.critical[_ngcontent-%COMP%]{background-position:0 -20px}.severe[_ngcontent-%COMP%], .error[_ngcontent-%COMP%]{background-position:0 -25px}.grayscale[_ngcontent-%COMP%]{filter:grayscale(100%);-webkit-filter:grayscale(100%)}@media print{.info[_ngcontent-%COMP%], .watch[_ngcontent-%COMP%], .warning[_ngcontent-%COMP%], .distress[_ngcontent-%COMP%], .critical[_ngcontent-%COMP%], .severe[_ngcontent-%COMP%], .error[_ngcontent-%COMP%]{-webkit-print-color-adjust:exact;print-color-adjust:exact}}"],changeDetection:0})}return i})();const et=["intervalSelect"];function it(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"button",4),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.createEvent())}),t.TgZ(1,"mat-icon"),t._uU(2,"add_circle_outline"),t.qZA(),t._uU(3," Create event "),t.qZA()}}function st(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"button",4),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.startStreaming())}),t.TgZ(1,"mat-icon"),t._uU(2,"play_arrow"),t.qZA(),t._uU(3," Start streaming "),t.qZA()}}function nt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"button",5),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.stopStreaming())}),t.TgZ(1,"mat-icon"),t._uU(2,"pause"),t.qZA(),t._uU(3," Stop streaming "),t.qZA()}}function at(i,s){if(1&i){const e=t.EpF();t.ynx(0),t._UZ(1,"ya-date-time-input",39)(2,"ya-date-time-input",40),t.TgZ(3,"button",38),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.applyCustomDates())}),t._uU(4,"Apply"),t.qZA(),t.BQk()}if(2&i){const e=t.oxw(2);t.xp6(3),t.Q6J("disabled",e.filterForm.invalid)}}function ot(i,s){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"button",41),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.jumpToNow())}),t._uU(2," Jump to now "),t.qZA(),t.BQk()}}function rt(i,s){1&i&&t._UZ(0,"ya-dots")}function lt(i,s){1&i&&(t.TgZ(0,"div",42),t._uU(1," Listening for events "),t._UZ(2,"ya-dots",43),t.qZA())}function ct(i,s){if(1&i&&(t.TgZ(0,"span"),t._uU(1," Showing events from "),t.TgZ(2,"b"),t._uU(3,"the last hour"),t.qZA(),t._uU(4," ending at "),t.TgZ(5,"b"),t._uU(6),t.ALo(7,"datetime"),t.qZA(),t._uU(8," (Mission Time) "),t.qZA()),2&i){const e=t.oxw(2);t.xp6(6),t.Oqu(t.lcZ(7,1,e.validStop))}}function ut(i,s){if(1&i&&(t.TgZ(0,"span"),t._uU(1," Showing events from "),t.TgZ(2,"b"),t._uU(3,"the last 6 hours"),t.qZA(),t._uU(4," ending at "),t.TgZ(5,"b"),t._uU(6),t.ALo(7,"datetime"),t.qZA(),t._uU(8," (Mission Time) "),t.qZA()),2&i){const e=t.oxw(2);t.xp6(6),t.Oqu(t.lcZ(7,1,e.validStop))}}function ht(i,s){if(1&i&&(t.TgZ(0,"span"),t._uU(1," Showing events from "),t.TgZ(2,"b"),t._uU(3,"the last 24 hours"),t.qZA(),t._uU(4," ending at "),t.TgZ(5,"b"),t._uU(6),t.ALo(7,"datetime"),t.qZA(),t._uU(8," (Mission Time) "),t.qZA()),2&i){const e=t.oxw(2);t.xp6(6),t.Oqu(t.lcZ(7,1,e.validStop))}}function mt(i,s){1&i&&(t.TgZ(0,"span"),t._uU(1," Showing events from "),t.TgZ(2,"b"),t._uU(3,"all time"),t.qZA()())}function gt(i,s){if(1&i&&(t.TgZ(0,"span"),t._uU(1," Showing events from "),t.TgZ(2,"b"),t._uU(3),t.ALo(4,"datetime"),t.qZA(),t._uU(5," to "),t.TgZ(6,"b"),t._uU(7),t.ALo(8,"datetime"),t.qZA(),t._uU(9," (Mission Time) "),t.qZA()),2&i){const e=t.oxw(2);t.xp6(3),t.Oqu(t.lcZ(4,2,e.validStart)),t.xp6(4),t.Oqu(t.lcZ(8,4,e.validStop))}}function pt(i,s){1&i&&(t.TgZ(0,"th",44),t._uU(1,"Severity"),t.qZA())}function dt(i,s){if(1&i&&(t.TgZ(0,"td",45),t._UZ(1,"app-event-severity",46),t.qZA()),2&i){const e=s.$implicit;t.xp6(1),t.Q6J("severity",e.severity)}}function ft(i,s){1&i&&(t.TgZ(0,"th",44),t._uU(1,"Message"),t.qZA())}function vt(i,s){if(1&i&&(t.TgZ(0,"td",47),t._UZ(1,"app-event-message",48),t.qZA()),2&i){const e=s.$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("message",e.message)("highlight",n.filterForm.value.filter)}}function _t(i,s){1&i&&(t.TgZ(0,"th",44),t._uU(1,"Type"),t.qZA())}function yt(i,s){if(1&i&&(t.TgZ(0,"td",45),t._uU(1),t.qZA()),2&i){const e=s.$implicit;t.xp6(1),t.hij(" ",e.type||"-"," ")}}function St(i,s){1&i&&(t.TgZ(0,"th",44),t._uU(1,"Source"),t.qZA())}function xt(i,s){if(1&i&&(t.TgZ(0,"td",45),t._uU(1),t.qZA()),2&i){const e=s.$implicit;t.xp6(1),t.hij(" ",e.source||"-"," ")}}function Tt(i,s){1&i&&(t.TgZ(0,"th",44),t._uU(1,"Generation Time"),t.qZA())}function Zt(i,s){if(1&i&&(t.TgZ(0,"td",49),t._uU(1),t.ALo(2,"datetime"),t.qZA()),2&i){const e=s.$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,e.generationTime)||"-"," ")}}function Ct(i,s){1&i&&(t.TgZ(0,"th",44),t._uU(1,"Reception Time"),t.qZA())}function bt(i,s){if(1&i&&(t.TgZ(0,"td",49),t._uU(1),t.ALo(2,"datetime"),t.qZA()),2&i){const e=s.$implicit;t.xp6(1),t.hij(" ",t.lcZ(2,1,e.receptionTime)||"-"," ")}}function Et(i,s){1&i&&(t.TgZ(0,"th",44),t._uU(1,"Sequence Number"),t.qZA())}function wt(i,s){if(1&i&&(t.TgZ(0,"td",45),t._uU(1),t.qZA()),2&i){const e=s.$implicit;let n;t.xp6(1),t.hij(" ",null!==(n=e.seqNumber)&&void 0!==n?n:"-"," ")}}function At(i,s){if(1&i&&(t.TgZ(0,"th",44),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.label)}}function Ut(i,s){if(1&i&&(t.ynx(0),t._uU(1),t.BQk()),2&i){const e=t.oxw().$implicit,n=t.oxw().$implicit;let a;t.xp6(1),t.hij(" ",null!==(a=e.extra[n.id])&&void 0!==a?a:"-"," ")}}function Ot(i,s){1&i&&(t.ynx(0),t._uU(1,"-"),t.BQk())}function Nt(i,s){if(1&i&&(t.TgZ(0,"td",45),t.YNc(1,Ut,2,1,"ng-container",16),t.YNc(2,Ot,2,0,"ng-container",16),t.qZA()),2&i){const e=s.$implicit;t.xp6(1),t.Q6J("ngIf",e.extra),t.xp6(1),t.Q6J("ngIf",!e.extra)}}function Pt(i,s){1&i&&(t.ynx(0,50),t.YNc(1,At,2,1,"th",24),t.YNc(2,Nt,3,2,"td",25),t.BQk()),2&i&&t.Q6J("cdkColumnDef",s.$implicit.id)}function It(i,s){1&i&&t._UZ(0,"tr",51)}function Mt(i,s){if(1&i&&t._UZ(0,"tr",52),2&i){const e=s.$implicit;t.Q6J("@rowAnimation",e.animate)("ngClass",e.severity)}}function kt(i,s){if(1&i){const e=t.EpF();t.TgZ(0,"div",6)(1,"form",7)(2,"div",8),t._UZ(3,"ya-search-filter",9)(4,"ya-column-chooser",10,11),t.qZA(),t.TgZ(6,"div",8),t._UZ(7,"ya-select",12)(8,"ya-multi-select",13),t.ALo(9,"async"),t._UZ(10,"ya-select",14,15),t.YNc(12,at,5,1,"ng-container",16),t.YNc(13,ot,3,0,"ng-container",16),t.YNc(14,rt,1,0,"ya-dots",16),t.ALo(15,"async"),t.YNc(16,lt,3,0,"div",17),t.ALo(17,"async"),t.qZA()(),t.TgZ(18,"div",18)(19,"div",19)(20,"ya-text-action",20),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.exportEvents())}),t._uU(21,"Download events"),t.qZA()(),t.YNc(22,ct,9,3,"span",21),t.YNc(23,ut,9,3,"span",21),t.YNc(24,ht,9,3,"span",21),t.YNc(25,mt,4,0,"span",21),t.YNc(26,gt,10,6,"span",21),t.qZA(),t.TgZ(27,"table",22),t.ynx(28,23),t.YNc(29,pt,2,0,"th",24),t.YNc(30,dt,2,1,"td",25),t.BQk(),t.ynx(31,26),t.YNc(32,ft,2,0,"th",24),t.YNc(33,vt,2,2,"td",27),t.BQk(),t.ynx(34,28),t.YNc(35,_t,2,0,"th",24),t.YNc(36,yt,2,1,"td",25),t.BQk(),t.ynx(37,29),t.YNc(38,St,2,0,"th",24),t.YNc(39,xt,2,1,"td",25),t.BQk(),t.ynx(40,30),t.YNc(41,Tt,2,0,"th",24),t.YNc(42,Zt,3,3,"td",31),t.BQk(),t.ynx(43,32),t.YNc(44,Ct,2,0,"th",24),t.YNc(45,bt,3,3,"td",31),t.BQk(),t.ynx(46,33),t.YNc(47,Et,2,0,"th",24),t.YNc(48,wt,2,1,"td",25),t.BQk(),t.YNc(49,Pt,3,1,"ng-container",34),t.YNc(50,It,1,0,"tr",35),t.ALo(51,"async"),t.YNc(52,Mt,1,2,"tr",36),t.ALo(53,"async"),t.qZA(),t.TgZ(54,"mat-toolbar"),t._UZ(55,"span",37),t.TgZ(56,"button",38),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.loadMoreData())}),t._uU(57,"Load More"),t.qZA(),t._UZ(58,"span",37),t.qZA()()}if(2&i){const e=t.MAs(5),n=t.oxw();t.xp6(1),t.Q6J("formGroup",n.filterForm),t.xp6(3),t.Q6J("columns",n.columns),t.xp6(3),t.Q6J("options",n.severityOptions),t.xp6(1),t.Q6J("options",t.lcZ(9,20,n.sourceOptions$)),t.xp6(2),t.Q6J("options",n.intervalOptions),t.xp6(2),t.Q6J("ngIf","CUSTOM"===n.filterForm.value.interval),t.xp6(1),t.Q6J("ngIf","CUSTOM"!==n.filterForm.value.interval),t.xp6(1),t.Q6J("ngIf",t.lcZ(15,22,n.dataSource.loading$)),t.xp6(2),t.Q6J("ngIf",t.lcZ(17,24,n.dataSource.streaming$)),t.xp6(2),t.Q6J("ngSwitch",n.appliedInterval),t.xp6(4),t.Q6J("ngSwitchCase","PT1H"),t.xp6(1),t.Q6J("ngSwitchCase","PT6H"),t.xp6(1),t.Q6J("ngSwitchCase","P1D"),t.xp6(1),t.Q6J("ngSwitchCase","NO_LIMIT"),t.xp6(1),t.Q6J("ngSwitchCase","CUSTOM"),t.xp6(1),t.Q6J("dataSource",n.dataSource),t.xp6(22),t.Q6J("ngForOf",n.extraColumns),t.xp6(1),t.Q6J("cdkHeaderRowDef",t.lcZ(51,26,e.displayedColumns$)),t.xp6(2),t.Q6J("cdkRowDefColumns",t.lcZ(53,28,e.displayedColumns$)),t.xp6(4),t.Q6J("disabled",!n.dataSource.hasMore())}}const _="PT1H";const Jt=[{path:"",canActivate:[S.r,w._],canActivateChild:[S.q],runGuardsAndResolvers:"always",component:U.K,children:[{path:"",pathMatch:"full",component:(()=>{class i{constructor(e,n,a,u,Qt,Ft,Rt,Yt){this.yamcs=e,this.authService=n,this.dialog=a,this.router=Qt,this.route=Ft,this.filterForm=new r.nJ({filter:new r.p4,severity:new r.p4("INFO"),source:new r.p4([]),interval:new r.p4(_),customStart:new r.p4(null),customStop:new r.p4(null)}),this.columns=[{id:"severity",label:"Severity",visible:!0},{id:"gentime",label:"Generation time",alwaysVisible:!0},{id:"message",label:"Message",alwaysVisible:!0},{id:"source",label:"Source",visible:!0},{id:"type",label:"Type",visible:!0},{id:"rectime",label:"Reception time"},{id:"seqNumber",label:"Sequence number"}],this.extraColumns=[],this.severityOptions=[{id:"INFO",label:"Info level"},{id:"WATCH",label:"Watch level"},{id:"WARNING",label:"Warning level"},{id:"DISTRESS",label:"Distress level"},{id:"CRITICAL",label:"Critical level"},{id:"SEVERE",label:"Severe level"}],this.sourceOptions$=new p.X([]),this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}],this.downloadURL$=new p.X(null),this.severity="INFO",this.source=[],Rt.setTitle("Events");const b=u.getConfig().events;if(b){this.extraColumns=b.extraColumns||[];for(const c of this.extraColumns)for(let m=0;m<this.columns.length;m++)if(this.columns[m].id===c.after){this.columns.splice(m+1,0,c);break}}e.yamcsClient.getEventSources(e.instance).then(c=>{for(const m of c)this.sourceOptions$.next([...this.sourceOptions$.value,{id:m,label:m}])}),this.dataSource=new M(e,Yt),this.dataSource.sources$.subscribe(c=>{this.sourceOptions$.next(c.map(m=>({id:m,label:m})))}),this.initializeOptions(),this.loadData(),this.filterForm.get("filter").valueChanges.pipe((0,O.b)(400)).forEach(c=>{this.filter=c,this.loadData()}),this.filterForm.get("severity").valueChanges.forEach(c=>{this.severity=c,this.loadData()}),this.filterForm.get("source").valueChanges.forEach(c=>{this.source=c,this.loadData()}),this.filterForm.get("interval").valueChanges.forEach(c=>{if("CUSTOM"===c){const m=this.validStart||this.yamcs.getMissionTime(),Lt=this.validStop||this.yamcs.getMissionTime();this.filterForm.get("customStart").setValue(o.P6.toISOString(m)),this.filterForm.get("customStop").setValue(o.P6.toISOString(Lt))}else"NO_LIMIT"===c?(this.validStart=null,this.validStop=null,this.appliedInterval=c,this.loadData()):(this.validStop=e.getMissionTime(),this.validStart=o.P6.subtractDuration(this.validStop,c),this.appliedInterval=c,this.loadData())})}initializeOptions(){const e=this.route.snapshot.queryParamMap;if(e.has("filter")&&(this.filter=e.get("filter")||"",this.filterForm.get("filter").setValue(this.filter)),e.has("severity")&&(this.severity=e.get("severity"),this.filterForm.get("severity").setValue(this.severity)),e.has("source")&&(this.source=e.getAll("source"),this.filterForm.get("source").setValue(this.source)),e.has("interval"))if(this.appliedInterval=e.get("interval"),this.filterForm.get("interval").setValue(this.appliedInterval),"CUSTOM"===this.appliedInterval){const n=e.get("customStart");this.filterForm.get("customStart").setValue(n),this.validStart=o.P6.toDate(n);const a=e.get("customStop");this.filterForm.get("customStop").setValue(a),this.validStop=o.P6.toDate(a)}else"NO_LIMIT"===this.appliedInterval?(this.validStart=null,this.validStop=null):(this.validStop=this.yamcs.getMissionTime(),this.validStart=o.P6.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval=_,this.validStop=this.yamcs.getMissionTime(),this.validStart=o.P6.subtractDuration(this.validStop,_)}jumpToNow(){const e=this.filterForm.value.interval;"NO_LIMIT"===e||"CUSTOM"===e?this.filterForm.get("interval").setValue(_):(this.validStop=this.yamcs.getMissionTime(),this.validStart=o.P6.subtractDuration(this.validStop,e),this.loadData())}startStreaming(){this.filterForm.get("interval").setValue("NO_LIMIT"),this.dataSource.startStreaming()}stopStreaming(){this.dataSource.stopStreaming()}applyCustomDates(){this.validStart=o.P6.toDate(this.filterForm.value.customStart),this.validStop=o.P6.toDate(this.filterForm.value.customStop),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();const e={severity:this.severity};this.validStart&&(e.start=this.validStart.toISOString()),this.validStop&&(e.stop=this.validStop.toISOString()),this.filter&&(e.q=this.filter),this.source.length&&(e.source=this.source),this.dataSource.loadEvents(e)}loadMoreData(){const e={severity:this.severity};this.validStart&&(e.start=this.validStart.toISOString()),this.filter&&(e.q=this.filter),this.source.length&&(e.source=this.source),this.dataSource.loadMoreData(e)}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{filter:this.filter||null,severity:this.severity,source:this.source.length?this.source:null,interval:this.appliedInterval,customStart:"CUSTOM"===this.appliedInterval?this.filterForm.value.customStart:null,customStop:"CUSTOM"===this.appliedInterval?this.filterForm.value.customStop:null},queryParamsHandling:"merge"})}mayWriteEvents(){return this.authService.getUser().hasSystemPrivilege("WriteEvents")}createEvent(){this.dialog.open(N,{width:"400px"}).afterClosed().subscribe(n=>{n&&this.jumpToNow()})}exportEvents(){this.dialog.open(k,{width:"400px",data:{severity:this.severity,severityOptions:this.severityOptions,start:this.validStart,stop:this.validStop,q:this.filter,source:this.source,sourceOptions:this.sourceOptions$.value}})}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(o.C8),t.Y36(x.e),t.Y36(h.uw),t.Y36(o.E4),t.Y36(d.F0),t.Y36(d.gz),t.Y36(J.Dx),t.Y36(o.jF))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["ng-component"]],viewQuery:function(n,a){if(1&n&&t.Gf(et,5),2&n){let u;t.iGM(u=t.CRH())&&(a.intervalSelect=u.first)}},decls:12,vars:8,consts:[["mat-button","","color","primary",3,"click",4,"ngIf"],["mat-button","","matTooltip","Pause streaming events","color","primary",3,"click",4,"ngIf"],["mat-icon-button","","matTooltip","Jump to now","color","primary",3,"click"],["class","panel-content",4,"ngIf"],["mat-button","","color","primary",3,"click"],["mat-button","","matTooltip","Pause streaming events","color","primary",3,"click"],[1,"panel-content"],[3,"formGroup"],[1,"filter-bar"],["formControlName","filter","placeholder","Filter by text search"],["preferenceKey","events",3,"columns"],["columnChooser",""],["formControlName","severity",3,"options"],["formControlName","source","emptyOption","Any source",3,"options"],["icon","access_time","formControlName","interval",3,"options"],["intervalSelect",""],[4,"ngIf"],["style","text-align: right; flex: 1 1 150px",4,"ngIf"],[1,"table-status",3,"ngSwitch"],[1,"message-zone"],[3,"click"],[4,"ngSwitchCase"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["cdkColumnDef","severity"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","message"],["mat-cell","","class","mono message expand",4,"cdkCellDef"],["cdkColumnDef","type"],["cdkColumnDef","source"],["cdkColumnDef","gentime"],["mat-cell","","style","white-space: nowrap",4,"cdkCellDef"],["cdkColumnDef","rectime"],["cdkColumnDef","seqNumber"],[3,"cdkColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",4,"cdkHeaderRowDef"],["mat-row","",3,"ngClass",4,"cdkRowDef","cdkRowDefColumns"],[2,"flex","1 1 auto"],[1,"ya-button",3,"disabled","click"],["formControlName","customStart"],["formControlName","customStop"],[1,"ya-button",3,"click"],[2,"text-align","right","flex","1 1 150px"],["fontSize","16px","color","#1b61b9"],["mat-header-cell",""],["mat-cell",""],[3,"severity"],["mat-cell","",1,"mono","message","expand"],[3,"message","highlight"],["mat-cell","",2,"white-space","nowrap"],[3,"cdkColumnDef"],["mat-header-row",""],["mat-row","",3,"ngClass"]],template:function(n,a){1&n&&(t.TgZ(0,"app-instance-page")(1,"app-instance-toolbar"),t._uU(2," Events \xa0\xa0\xa0 "),t.YNc(3,it,4,0,"button",0),t.YNc(4,st,4,0,"button",0),t.ALo(5,"async"),t.YNc(6,nt,4,0,"button",1),t.ALo(7,"async"),t.TgZ(8,"button",2),t.NdJ("click",function(){return a.jumpToNow()}),t.TgZ(9,"mat-icon"),t._uU(10,"refresh"),t.qZA()()(),t.YNc(11,kt,59,30,"div",3),t.qZA()),2&n&&(t.xp6(3),t.Q6J("ngIf",a.mayWriteEvents()),t.xp6(1),t.Q6J("ngIf",!t.lcZ(5,4,a.dataSource.streaming$)),t.xp6(2),t.Q6J("ngIf",t.lcZ(7,6,a.dataSource.streaming$)),t.xp6(5),t.Q6J("ngIf",a.dataSource))},dependencies:[g.mk,g.sg,g.O5,g.RF,g.n9,r._Y,r.JJ,r.JL,r.sg,r.u,f.Sq,f.O_,f.D5,f.fo,f.s$,Z.lW,Z.RK,q.Hw,v.BZ,v.ge,v.ev,v.XQ,v.Gk,D.Ye,Q.gM,o.b8,o.t,o.Zy,o.OP,o.cF,o.Hr,o.ll,F.a,R.k,H,tt,g.Ov,o.id],styles:[".table-status[_ngcontent-%COMP%]{background-color:#f7f7f7;height:24px;line-height:24px;font-size:12px;padding-left:6px}.table-status[_ngcontent-%COMP%]   .message-zone[_ngcontent-%COMP%]{float:right;height:24px;line-height:24px;font-size:12px;padding-right:6px}.ya-data-table[_ngcontent-%COMP%]   td.mat-mdc-cell.message[_ngcontent-%COMP%]{white-space:pre-wrap}"],data:{animation:[o.q5]},changeDetection:0})}return i})(),canActivate:[(i,s)=>(0,t.f3M)(T).canActivate(i,s)]}]}];let qt=(()=>{class i{static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275mod=t.oAB({type:i});static#i=this.\u0275inj=t.cJS({imports:[d.Bz.forChild(Jt),d.Bz]})}return i})(),Dt=(()=>{class i{static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275mod=t.oAB({type:i});static#i=this.\u0275inj=t.cJS({imports:[E.m,qt]})}return i})()}}]);